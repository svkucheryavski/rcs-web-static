<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="ru">
<meta name="GENERATOR" content="Microsoft FrontPage 12.0">
<title>Калибровка (Градуировка)</title>
<style>
<!--
h1           {
	font-family: Arial;
	font-size: 14pt;
	font-weight: bold;
	text-align: Center;
	padding-top: 75px;
}
#menu        { font-family: Tahoma; font-size: 12pt; font-weight: bold }
h2           {
	font-family: Arial;
	font-size: 12pt;
	font-style: italic;
	padding-top: 25px;
}
.header      { font-family: Arial; font-size: 18pt; letter-spacing: 1; font-weight: bold; 
               text-align: Center }
.style1 {
	vertical-align: middle;
}
.style4 {
	vertical-align: text-top;
	text-align: center;
}
.style5 {
	border-width: 0;
}
address {
	font-family: Arial, Helvetica, sans-serif;
}
address {
	font-family: Arial, Helvetica, sans-serif;
}
address {
	font-family: Arial, Helvetica, sans-serif;
}
.newStyle1 {
	font-family: Arial, Helvetica, sans-serif;
}
.address {
	font-family: Arial, Helvetica, sans-serif;
}
.style7 {
	text-align: center;
}
.style8 {
	text-align: left;
}
.style10 {
	text-decoration: underline;
}
.prog {
	font-family: "Courier New", Courier, monospace;
}
.style11 {
	border-width: 0;
	vertical-align: middle;
}
-->
</style>
        <title></title>
</head>

<body>

<p>&nbsp;</p>
  <center>
  <table border="0" width="95%" cellpadding="0" cellspacing="0">
    <tr>
      <td width="100%">
</center>
      <h3 class="header">Калибровка (Градуировка)</h3>
      <dl>
        <div align="center">
          <center>
          <dt>© <span lang="en-us">2008 </span>Алексей Померанцев</dt>
          </center>
        </div>
        <div align="center">
          <center>
          <dt><a href="../index.html">Российское хемометрическое
        общество</a></dt>
          </center>
        </div>
      </dl>
        <h1><a name="Contents"></a>Содержание&nbsp;</h1>
        <dl>
          <dt><a href="#Ch0"><b>Введение</b></a></dt>
          <dt><a href="#Ch1"><b>1. Базовые сведения</b></a></dt>
          <dd><b><a href="#Ch1.1">1.1. Постановка задачи&nbsp;</a></b></dd>
          <dd><b><a href="#Ch1.2">1.2. Линейная и нелинейная
            калибровки</a></b></dd>
          <dd><b><a href="#Ch1.3">1.3. Калибровка и проверка</a></b></dd>
          <dd><b><a href="#Ch1.4">1.4. &quot;Качество&quot;
            калибровки</a></b></dd>
          <dd><b><a href="#Ch1.5">1.5. Неопределенность,
            точность и воспроизводимость</a></b></dd>
          <dd><b><a href="#Ch1.6">1.6. Недооценка и
            переоценка</a></b></dd>
          <dd><b><a href="#Ch1.7">1.7. Мультиколлинеарность</a></b></dd>
          <dd><b><a href="#Ch1.8">1.8. Подготовка данных</a></b></dd>
          <dt><b><a href="#Ch2">2. Модельные данные</a></b></dt>
          <dd><b><a href="#Ch2.1">2.1. Принцип линейности</a></b></dd>
          <dd><b><a href="#Ch2.2">2.2. &quot;Чистые&quot; спектры</a></b></dd>
          <dd><b><a href="#Ch2.3">2.3. &quot;Стандартные&quot;
            образцы&nbsp;</a></b></dd>
          <dd><b><a href="#Ch2.4">2.4. Создание X данных</a></b></dd>
          <dd><b><a href="#Ch2.5">2.5. Центрирование данных&nbsp;</a></b></dd>
          <dd><b><a href="#Ch2.6">2.6. Обзор данных</a></b></dd>
          <dt><b><a href="#Ch3">3. Классическая калибровка</a></b></dt>
          <dd><b><a href="#Ch3.1">3,1. Калибровка по одному каналу 
			(однофакторная)</a></b></dd>
          <dd><b><a href="#Ch3.2">3.2. Метод Фирордта</a></b></dd>
          <dd><b><a href="#Ch3.3">3.3. Непрямая калибровка</a></b></dd>
          <dt><b><a href="#Ch4">4. Обратная калибровка</a></b></dt>
          <dd><b><a href="#Ch4.1">4.1. Множественная калибровка</a></b></dd>
          <dd><b><a href="#Ch4.2">4.2. Пошаговая калибровка</a></b></dd>
			<dt><span lang="en-us"><a href="#ch5"><strong>5. Калибровка на 
			латентных переменных</strong></a></span></dt>
          <dd><a href="#Ch5.1"><strong>5.1. Проекционные методы</strong></a></dd>
			<dd><strong><a href="#Ch5.2">5.2. Регрессия на латентных переменных</a></strong></dd>
			<dd><b><a href="#Ch5.3"><span lang="en-us">5</span>.3. Практическое 
			применение калибровки&nbsp;на латентных переменных</a></b></dd>
          <dd><b><a href="#Ch5.4"><span lang="en-us">5.</span>4. Регрессия на главные
            компоненты (PCR)</a></b></dd>
          <dd><b><a href="#Ch5.5"><span lang="en-us">5.</span>5. Регрессия на
            латентные структуры -1 (PLS1)</a></b></dd>
          <dd><b><a href="#Ch5.6"><span lang="en-us">5.</span>6. Регрессия на
            латентные структуры -2 (PLS2)</a></b></dd>
          <dt><b><a href="#Ch6"><span lang="en-us">6</span>. Заключение</a></b></dt>
          <dd><b><a href="#Ch6.1"><span lang="en-us">6</span>.1. Сравнение разных
            методов&nbsp;</a></b></dd>
          <dd><b><a href="#Ch6.2"><span lang="en-us">6</span>.2. Выводы</a></b></dd>
          <dd>&nbsp;</dd>
          <dd><a name="Ch0"></a>&nbsp;</dd>
        </dl>
        <h1>Введение&nbsp;</h1>
        <p>В этом пособии рассмотрены основные
        методы, применяемые для решения задач
        калибровки (называемой также
        градуировкой). Текст ориентирован,
        прежде всего, на специалистов в области
        анализа экспериментальных данных:
        химиков, физиков, биологов, и т.д. Он
        может служить пособием для
        исследователей, начинающих изучение
        этого вопроса. Продолжить
        исследования&nbsp; можно с помощью указанной
        <a href="references.htm">
        литературы</a>.&nbsp;</p>
      <p>В пособии интенсивно используются
        понятия и методы матричной алгебры –
        вектор, матрица, и т.п. Читателям,
        которые плохо знакомы с этим аппаратом,
        рекомендуется изучить, или, хотя бы
        просмотреть, пособие &quot;<a href="matrix.htm">Матрицы и векторы</a>&quot;.&nbsp;</p>
      <p>Изложение иллюстрируется примерами,
      выполненными в рабочей книге Excel “<a href="calibration/Calibration.xls#Intro!A1"><cite>Calibration.xls</cite></a>”,
      которая сопровождает этот документ. Предполагается, что читатель имеет
      базовые навыки работы в среде Excel, умеет
      проводить простейшие <a href="excel.htm">матричные
      вычисления</a> с использованием функций
      листа, таких как <a href="excel.htm#MMULT">МУМНОЖ</a>,
      <a href="excel.htm#TREND">ТЕНДЕНЦИЯ</a>&nbsp;
      и т.п. Освежить эти знания можно с помощью пособия <a href="excel.htm">Матричные операции в 
			Excel</a>.</p>
      <p align="center"><b><a href="moffice.htm">Важная
      информация о работе с
              файлом Calibration.xls</a>&nbsp;</b></p>
      <p>Ссылки на примеры помещены в текст как
      объекты Excel. По форме эти примеры имеют
      абстрактный, модельный характер, однако,
      по своей сути, они тесно связаны с
      задачами, встречающимися на практике.&nbsp;</p>
      <p class="style4"><b><a href="../Tutorials">Другие 
		пособия по хемометрике</a></b></p>
          <p style="line-height: 150%"><a href="#Contents">Содержание</a>
          <a name="Ch1"></a>
        <h1>1. Базовые сведения<a name="Ch1.1"></a> </h1>
        <h2>&nbsp;1.1. Постановка задачи</h2>
        <p>Суть задачи <i> калибровки</i> состоит в
        следующем. Пусть имеется некоторая
        переменная (свойство) <i>y</i>, величину
        которой необходимо установить. Однако,
        по ряду обстоятельств (недоступность,
        дороговизна, длительность), прямое
        измерение<span lang="en-us"> </span>величины <i> y</i> невозможно. В то же время
        можно легко (быстро, дешево) измерить
        другие величины: <b>x</b>=(<i>x</i><sub>1</sub>, <i>x</i><sub>2</sub>,
        <i>x</i><sub>3</sub>,…), которые связаны с
        искомой величиной <i>y</i>. Задача
        калибровки состоит в установлении
        количественной связи между <i>
        переменными</i> <b> x</b> и <i> откликом</i> <i> y</i> –&nbsp;</p>
      <p align="center"><i>y</i>=<i>f</i>(<i>x</i><sub>1</sub>, <i>x</i><sub>2</sub>,
        <i>x</i><sub>3</sub>,…| <i> a</i><sub>1</sub>,<i> a</i><sub>2</sub>, <i> a</i><sub>3</sub>,…)
        +&#949;</p>
        <p>На практике это означает:&nbsp;</p>
      <blockquote>
        <p>(1) подбор
        вида зависимости <i>f</i>, и&nbsp;...&nbsp;</p>
        <p>(2) оценку
        неизвестных параметров <i> a</i><sub>1</sub>,<i> a</i><sub>2</sub>,
        <i> a</i><sub>3</sub>,… в этой калибровочной зависимости.&nbsp;</p>
      </blockquote>
        <p> Разумеется,
        калибровку нельзя построить абсолютно
        точно. В дальнейшем мы увидим, что это
        не только невозможно, но и опасно. В калибровочной зависимости
        всегда присутствуют погрешности (ошибки)
        &#949;, источник которых – пробоотобор,
        измерения, моделирование, и т.д.</p>
        <p>Простейший пример калибровки дает
        общеизвестный прибор, называемый
        безменом, т.е. пружинные весы. Искомая
        величина <i>y</i> – это вес образца, а <i>x</i> –
        это удлинение пружины весов. <a href="http://ru.wikipedia.org/w/index.php?title=%D0%97%D0%B0%D0%BA%D0%BE%D0%BD_%D0%93%D1%83%D0%BA%D0%B0&amp;oldid=6478188"> Закон Гука</a>
        –&nbsp;</p>
        <p align="center"><i>y</i>=<i>ax </i>+ &#949;,&nbsp;</p>
      <p>связывает <i>y</i> и <i>x</i> через
      коэффициент жесткости пружины <i>a</i>,
      который априори неизвестен. Процедура
      калибровки очень проста
        – взвешиваем <i>
      стандартный образец</i> весом в 1 кг и
      отмечаем на шкале удлинение пружины,
      затем используем образец в 2 кг, и т.д. В
      результате этой калибровки (точнее,
      градуировки) получается шкала, по
      которой можно определить вес нового,
      нестандартного образца.&nbsp;</p>
      <p>Этот элементарный пример
      демонстрирует основные черты процедуры
      калибровки, которые подробно будут
      рассмотрены далее. Во-первых, для
      калибровки необходимы несколько
      стандартных образцов, для которых
      величины <i>y</i> известны заранее. Во-вторых,
      диапазон, в котором предполагается
      измерять показатель <i>y</i>, должен
      полностью покрываться этими калибровочными образцами.
      Действительно, нельзя измерять образцы
      весом более 5 кг, если в калибровке
      использовались образцы,
      весом менее чем 5 кг.</p>
        <p>Разумеется, на практике все обстоит
        не так просто, как в этом элементарном
        примере. Например, в калибровке может
        участвовать не один показатель <i>y</i> (отклик),
        а несколько откликов <i>y</i><sub>1</sub>, <i>y</i><sub>2</sub>,.....
        <i>y</i><sub><i>K</i></sub>, которые нас интересуют.
        Все возможные особенности, различные
        трудности, сопутствующие процедуре
        калибровке будут рассмотрены далее.
        Сейчас же мы подведем первые итоги и
        сформулируем задачу калибровки в общем
        виде.</p>
      <p>Пусть имеется матрица <b> Y</b>, размерностью (<i>I</i>&times;<i>K</i>),
        где <i> I</i> – это число стандартных образцов
      (сравнения), использованных в калибровке, а <i> K</i> 
        – это число
      одновременно калибруемых откликов.&nbsp;Матрица <b>Y</b> содержит значения откликов
      <i>y</i>, известные из независимых
      экспериментов (референтные или
      стандартные значения). Пусть, с другой
      стороны, имеется соответствующая
      матрица переменных <b>X</b> размерностью (<i>I</i>&times;<i>J</i>),&nbsp;
      где <i>I</i> 
        – это, естественно, тоже число
      образцов, а <i>J</i> – это число независимых
      переменных (каналов), используемых в
      калибровке. Матрица <b>X</b> состоит из
      альтернативных, как правило,
      многоканальных (<i>J</i>&gt;&gt;1) измерений.
      Используя калибровочные данные (<b>X</b>, <b>Y</b>),
      требуется построить функциональную
      связь между <b>Y</b> и <b>X</b>.<samp><a name="Fig01"></a></samp></p>
        <p></p>
        <p align="center">&nbsp;<img border="0" src="calibration/Fig01.gif" align="center" width="438" height="175"></p>
        <p align="center"><samp>Рис. 1
        Калибровочный набор данных</samp></p>
      <p>Итак, задача калибровки состоит в
      построении математической модели,
      связывающей блоки <b>X</b> и <b>Y</b>, с помощью
      которой можно в дальнейшем
      предсказывать значения показателей <i>y</i><sub>1</sub>,
      <i>y</i><sub>2</sub>,..... <i>y</i><sub><i>K</i></sub>, по новой
      строке значений аналитического сигнала <b>x</b>. </p>
        <p><a href="#Contents">Содержание</a>&nbsp; <a name="Ch1.2"></a> </p>
        <h2>1.2.&nbsp;Линейная и нелинейная
        калибровки </h2>
        <p>Теоретически функциональная связь
        между переменными <i>x</i> и <i>y</i> может
        быть сложной, например,&nbsp;</p>
        <p align="center"><i>y=b</i><sub>0 </sub>exp(<i>b</i><sub>1</sub><i>x+b</i><sub>2</sub><i>x</i><sup>2</sup>)<i>
        + </i>&#949;<i> .&nbsp;</i></p>
        <p>Однако на практике большинство
        используемых калибровок являются <i>
        линейными</i>, т.е. имеют вид
        –&nbsp;</p>
      <p align="center"><i>y=b</i><sub>0 </sub>+ <i>b</i><sub>1</sub><i>x</i><sub>1</sub><i>
      + b</i><sub>2</sub><i>x</i><sub>2</sub>+...+ <i>b</i><sub><i>J</i></sub><i>x</i><sub><i>J</i></sub><i>
      + </i>&#949;<i>
      .</i></p>
        <p>Заметим, что термин &quot;линейность&quot;
        употребляется в контексте этого
        пособия вместо более правильного
        термина &quot;билинейность&quot;,
        означающего линейность как по
        отношению к переменным <i>x</i>, так и в
        отношении коэффициентов <i>b</i>. Поэтому,
        калибровка</p>
      <p align="center"><i>y=b</i><sub>0 </sub>+ <i>b</i><sub>1</sub><i>x + b</i><sub>2</sub><i>x</i><sup>2
      </sup>+<i> </i>&#949;<i> .</i></p>
        <p>является нелинейной, несмотря на то,
        что она легко &quot;линеаризуется&quot;
        введением новой переменной <i>x</i><sub>2</sub>=<i>x</i><sup>2</sup>.</p>
        <p>Главное преимущество билинейной
        модели – это единственность, тогда как
        все прочие калибровки образуют
        бесконечное множество, выбор из
        которого затруднителен. В этом пособии
        рассматриваются только линейные
        калибровки вида
        –</p>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><a name="Eq1"></a><b>Y </b>= <b>XB </b>+ <b>E</b>.</td>
              <td>
                <p align="center">(1)</td>
            </tr>
          </table>
          </center>
        </div>
      <p>Читатели, заинтересованные в
        изучении нелинейных методов анализа
        данных могут обратиться к описанию <a href="http://polycert.chph.ras.ru/fitter.htm">программы
      Fitter</a>.&nbsp;
        <p>Предпочтение (би)линейных, формальных
        моделей, не отягощенных дополнительным
        физико-химическим смыслом, является
        магистральным направлением развития
        хемометрики. Такой подход позволяет
        исключить влияние субъективного
        фактора, проявляющегося при выборе
        калибровочной зависимости. Однако за
        это приходится расплачиваться – все
        линейные модели имеют ограниченную
        область применения.<samp><a name="Fig02"></a></samp>
        <p align="center"><img border="0" src="calibration/Fig02.jpg" width="416" height="340">
        <p align="center"><samp>Рис. 2
        Линеаризация калибровки</samp></p>
      <p>Суть дела иллюстрирует Рис. 2, где
        показаны четыре участка, на которых
        сложная нелинейная зависимость
        приближается простыми линейными
        моделями. Каждая из этих моделей
        работает только на своей области
        переменной<i> x</i> и выход за ее границы
        приводит к грубым ошибкам.
        Принципиальным моментом здесь
        является то, какую область можно
        считать допустимой
        – иначе говоря,
        насколько широко можно применять
        калибровочную модель. Ответ на этот
        вопрос дают методы <i> проверки</i> (валидации).
        <p><a href="#Contents">Содержание</a><a name="Ch1.3"></a>
      <h2>1.3. Калибровка и проверка</h2>
        <p>При надлежащем построении
        калибровочной модели исходный массив
        данных состоит из двух независимо
        полученных наборов, каждый из которых
        является достаточно представительным.
        Первый набор, называемый <em>обучающим</em>,
        используется для идентификации модели,
        т.е. для оценки ее параметров. Второй
        набор, называемый <em>проверочным</em>, служит
        только для проверки модели.
        Построенная модель применяется к
        данным из проверочного набора, и
        полученные результаты сравниваются с
        проверочными значениями. Таким образом
        принимается решение о правильности,
        точности моделирования методом тест-валидации.<samp><a name="Fig03"></a></samp>
        <p align="center"><img border="0" src="calibration/Fig03.gif" width="466" height="324">
        <p align="center"><samp>Рис. 3
        Обучающий и проверочный наборы</samp></p>
      <p align="left">В некоторых случаях объем
      данных слишком мал для такой проверки.
      Тогда применяют другой метод – <i> перекрестной проверки</i> (кросс-валидация,
      скользящая проверка). В этом методе
      проверочные значения вычисляют с
      помощью следующей процедуры.&nbsp;
        <p align="left">Некоторую фиксированную долю (например,
        первые 10% образцов) исключают из
        исходного набора данных. Затем строят
        модель, используя только оставшиеся 90%
        данных, и применяют ее к исключенному
        набору. На следующем цикле исключенные
        данные возвращаются, и удаляется уже
        другая порция данных (следующие 10%), и
        опять строится модель, которая
        применяется к исключенным данным. Эта
        процедура повторяется до тех пор, пока
        все данные не побывают в числе
        исключенных (в нашем случае – 10 циклов).
        Наиболее (но неоправданно) популярен
        вариант перекрестной проверки, в
        котором данные исключаются по одному (Leave-One-Out
        – LOO).<samp><a name="Fig04"></a></samp>
        <p align="center"><img border="0" src="calibration/Fig04.gif" loop="infinite" width="552" height="355">
        <p align="center"><samp>Рис. 4 Метод
        перекрестной проверки</samp></p>
        <p align="left">Используется также проверка
        методом корректировки <i> размахом</i>, суть
        которой предлагается изучить
        самостоятельно по <a href="references.htm#L2.1"> книгам</a>.
        <p><a href="#Contents">Содержание</a><span lang="en-us"> <a name="Ch1.4">
		</a></span></p>
      <h2>1.4. &quot;Качество&quot; калибровки&nbsp;</h2>
      <p>Результатом калибровки являются
        величины 
		<img border="0" src="calibration/image001.gif" align="middle" width="20" height="27" class="style1">–
      <i>
      оценки</i> стандартных откликов <b>Y</b><sub>c</sub>,
        найденные по модели, построенной на
        обучающем наборе. Результатом проверки
        служат величины 
		<img border="0" src="calibration/image002.gif" align="middle" width="20" height="27" class="style1">–
      оценки проверочных откликов <b>Y</b><sub>t</sub>,
        вычисленные по той же модели.
        Отклонение оценки от стандарта (проверочного
        значения) вычисляют как матрицу
        остатков: в обучении 
		<img border="0" src="calibration/image003.gif" align="middle" width="85" height="27" class="style1">,
        и в проверке 
		<img border="0" src="calibration/image004.gif" align="absbottom" width="81" height="27" class="style1">.<samp><a name="Fig05"></a></samp></p>
        <p align="center"><img border="0" src="calibration/Fig05.gif" width="366" height="321"><p align="center"><samp>Рис.
      5 Остатки в обучении и в проверке</samp></p>
      <p>Следующие величины характеризуют &quot;качество&quot;
      калибровки в среднем.&nbsp;</p>
      <ul>
        <li><i>Полная дисперсия остатков</i> в обучении
          (TRVC) и в проверке (TRVP)
        –</li>
      </ul>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq2"></a> <img border="0" src="calibration/image005.gif" width="148" height="49"></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <img border="0" src="calibration/image006.gif" width="145" height="49"></td>
              <td>
                <p align="center">(2)</td>
            </tr>
          </table>
          </center>
        </div>
      <blockquote>
        <blockquote>
          <p>Эти величины вычисляются по <a href="statistics.htm#Eq10">формуле 
			(10) в пособии Статистика</a>, для <span lang="en-us"><em>m</em>=0</span>.</p>
        </blockquote>
      </blockquote>
      <ul>
        <li><i>Объясненная дисперсия остатков</i> при
          обучении (ERVC) и при проверке (ERVP)
        –</li>
      </ul>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq3"></a><img border="0" src="calibration/image007.gif" width="211" height="49">&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <img border="0" src="calibration/image008.gif" width="209" height="49"></td>
              <td>
                <p align="center">(3)</td>
            </tr>
          </table>
          </center>
        </div>
      <ul>
        <li><i>Среднеквадратичные остатки </i>
          калибровки (RMSEC) и проверки (RMSEP)
        –&nbsp;</li>
      </ul>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq4"></a><img border="0" src="calibration/image009.gif" width="161" height="53">&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <img border="0" src="calibration/image010.gif" width="159" height="53"></td>
              <td>
                <p align="center">(4)</td>
            </tr>
          </table>
          </center>
        </div>
      <blockquote>
        <blockquote>
          <p>Величины RMSE зависят от <i>k</i> – номера
          отклика.</p>
        </blockquote>
      </blockquote>
      <ul>
        <li><i>Смещение </i> в калибровке (BIASC) и в
          проверке (BIASP)
        –&nbsp;</li>
      </ul>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq5"></a> <img border="0" src="calibration/image011.gif" width="141" height="49"></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <img border="0" src="calibration/image012.gif" width="139" height="49"></td>
              <td>
                <p align="center">(5)</td>
            </tr>
          </table>
          </center>
        </div>
      <blockquote>
        <blockquote>
          <p>Величины BIAS зависят от <i> k</i> – номера
          отклика.&nbsp;</p>
        </blockquote>
      </blockquote>
      <ul>
        <li><i>Стандартные ошибки</i> в калибровке (SEC) и
          в проверке (SEP)
        –&nbsp;</li>
      </ul>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq6"></a><img border="0" src="calibration/image013.gif" width="231" height="53">&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <img border="0" src="calibration/image014.gif" width="227" height="53"></td>
              <td>
                <p align="center">(6)</td>
            </tr>
          </table>
          </center>
        </div>
      <blockquote>
        <blockquote>
          <p>Величины SE зависят от <i>k</i> – номера
          отклика.<span lang="en-us"> </span>Они вычисляются по
			<a href="statistics.htm#Eq9">формуле (9) из пособия Статистика</a>.</p>
        </blockquote>
      </blockquote>
      <ul>
        <li><i>Коэффициенты <a href="statistics.htm#Ch1.9">корреляции</a></i> <i>R</i><sup>2 </sup>между
          стандартными <i>y</i><sub><i>ki</i></sub> и оцененными
          <img border="0" src="calibration/image015.gif" align="middle" width="23" height="23">
          откликами. Они также вычисляется
          отдельно для обучающего <img border="0" src="calibration/image016.gif" align="absmiddle" width="44" height="27">и
          проверочного <img border="0" src="calibration/image017.gif" align="absmiddle" width="43" height="27">наборов.&nbsp;</li>
      </ul>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq7"></a>&nbsp;</b>&nbsp;&nbsp; <img border="0" src="calibration/image018.gif" width="305" height="53"></td>
              <td>
                <p align="center">(7)</td>
            </tr>
          </table>
          </center>
        </div>
      <blockquote>
        <blockquote>
          <p>Величины <i>R</i><sup>2</sup> зависят от <i>k</i> –
          номера отклика.</p>
        </blockquote>
      </blockquote>
      <p>Во всех этих формулах величины <i>e</i><sub><i>ki</i></sub>
      – это элементы матриц <b>E</b><sub>c</sub> или <b>E</b><sub>t</sub>.
      Для характеристик, наименование которых
      оканчивается на C (например, RMSEC),
      используется матрица <b>E</b><sub>c</sub> (обучение),
      а для тех, которые оканчиваются на P (например,
      RMSEP), берется матрица <b>E</b><sub>t</sub> (проверка).</p>
        <p align="left"><a href="#Contents">Содержание</a><a name="Ch1.5"></a></p>
        <h2 align="left">1.5. Неопределенность, точность
        и воспроизводимость&nbsp;</h2>
        <p align="left">Такое большое число
        показателей, характеризующих качество
        калибровки, объясняется не только
        историческими причинами, но и тем, что
        они отражают различные свойства
        неопределенности при обучении, и при
        проверке (прогнозе). Для объяснения
        этих показателей необходимо ввести
        понятия воспроизводимости (прецизионности)
        и точности.&nbsp;
        <p align="left"><i>Воспроизводимость</i> (precision)
        характеризует то, насколько близко
        находятся друг от друга независимые
        повторные измерения.
        <p align="left"><i>Точность</i> (accuracy) определяет
        степень близости оценок к истинному (стандартному)
        значению <i>y</i>.<samp><a name="Fig06"></a></samp>
        <p align="center"><img border="0" src="calibration/Fig06.gif" width="553" height="220"><p align="center"><samp>Рис.6
      Точность и воспроизводимость</samp></p>
        <p align="left">Рис. 6 объясняет суть дела.
        Графики a) и b) представляют оценки с
        хорошей воспроизводимостью. Вариант a) ,
        кроме того, обладает и высокой
        точностью, что, разумеется, нельзя
        сказать о графике c). В последнем случае
        и воспроизводимость, и точность
        оставляют желать лучшего.&nbsp;
        <p align="left">Показатели SEC и SEP
        характеризуют воспроизводимость
        калибровки, тогда как RMSEC и RMSEP
        показывают ее точность. Величины BIASC и
        BIASP определяют смещение калибровки
        относительно истинного значения (Рис.
        6b). <a href="statistics.htm#Eq15">Можно показать</a>, что
        –&nbsp;
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="50">
            <tr>
              <td width="90%">
                <p align="center"><b>&nbsp;</b>&nbsp;&nbsp;
                RMSE<sup>2</sup> = SE<sup>2</sup> + BIAS<sup>2</sup>.</td>
              <td>
                <p align="center">(8)</td>
            </tr>
          </table>
          </center>
        </div>
        <p align="left">Таким образом, при построении
        калибровки предпочтение следует
        отдавать показателям RMSE, а не SE.<p align="left">Показатели TRV
      и ERV характеризуют
        ситуацию &quot;в целом&quot;, без различения
        калибруемых откликов, т.е.
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq9"></a>&nbsp;</b>&nbsp;&nbsp; <img border="0" src="calibration/image019.gif" width="161" height="48"></td>
              <td>
                <p align="center">(9)</td>
            </tr>
          </table>
          </center>
        </div>
        <p align="left"><a href="#Contents">Содержание</a><a name="Ch1.6"></a>
      <h2 align="left">1.6. Недооценка и переоценка&nbsp;</h2>
        <p align="left">При построении калибровки
        исследователь часто имеет возможность
        последовательного усложнения модели.
        Приведем простейший пример,
        иллюстрирующий этот процесс.<p align="left">Из курса школьной физики
        известно, что расстояние <i>L</i>, на
        которое летит снаряд, выпущенный со
        скоростью <i>v</i> из орудия, наклоненного
        под углом &#945; к
        горизонту, равно –&nbsp;
        <p align="center"><i>L</i>=<i>v</i><sup>2</sup>sin(2&#945;)/<i>g</i>.&nbsp;<p align="left">Предположим, что у нас имеются
        экспериментальные данные <i>L</i>(&#945;
        ).<samp><a name="Fig07"></a></samp>
        <p align="center">
		<img src="calibration/Fig07.png" width="143" height="307"><p align="center"><samp>Рис.7
      </samp><samp>Данные для артиллерийского
      примера</samp></p>
        <p align="left">Забудем о том, что
        функциональная связь между <i>L</i> (т.е., <i>y</i>)
        и &#945; (т.е., <i>x</i>) нам
        известна, и попробуем построить
        формальную полиномиальную калибровку –&nbsp;
        <p align="center"><i>L</i>=<i>b</i><sub>0 </sub>+ <i>b</i><sub>1</sub>&#945;<span lang="en-us">
		</span>+<i><span lang="en-us"> </span>b</i><sub>2</sub>&#945;<sup>2</sup>
        +…. <i>b</i><sub><i>n</i></sub> &#945;<sup><i>n</i> </sup>+ &#949;<i> &nbsp;</i>&nbsp;
        <p align="left">по этим данным. На <a href="#Fig08"> Рис. 8а</a>
        показано, как описываются обучающие (<img border="0" src="calibration/box1.gif" width="7" height="7">)
        и проверочные (<img border="0" src="calibration/box2.gif" width="9" height="9">) данные моделями при
        <i> n</i>=0,
        1, .., 5. Видно, что при недостаточной
        сложности модели (<i>n </i>= 0, 1) обучающие данные
        лежат далеко от модели. Это – случай <i>
        недооценки</i>. Когда сложность модели
        увеличивается, то согласие между
        обучающими данными и моделью
        улучшается. Однако, при излишней
        сложности (<i>n </i>= 4, 5), модель все хуже
        работает при прогнозе на проверочный
        набор. Это
        – случай <i> переоценки</i>.<samp><a name="Fig08"></a></samp>
        <p align="center">
		<img src="calibration/Fig08.png" width="687" height="343">&nbsp;<p align="center"><samp>Рис.8
      Артиллерийский пример.&nbsp;<br>
      a)Калибровка, b)Среднеквадратичные
      остатки обучения (RMSEC)и проверки (RMSEP)</samp></p>
      <p align="left">На Рис. 8b показано, как
        изменяются показатели RMSEC и RMSEP при
        увеличении сложности модели. Это – типичный график, в котором RMSEC
        монотонно падает, а RMSEP проходит через
        минимум. Именно точка минимума RMSEP
        позволяет определить оптимальную
        сложность модели. В нашем случае – это 2.
        Теперь мы можем вспомнить о
        содержательной модели, которая хорошо
        аппроксимируется полиномом второй
        степени по &#945;<span lang="en-us"> </span>–&nbsp;
        <p align="center"><i>L</i>=<i>v</i><sup>2</sup>/<i>g</i> sin(2&#945;)<i><span lang="en-us">
		</span> </i>&#8776;<i><span lang="en-us"> </span>Const </i>&#945;(&#945;<span lang="en-us">
		</span>– &#960;/4)&nbsp;
        <p align="left">В задачах многомерной
        калибровки недооценка и переоценка
        проявляются через выбор числа скрытых,
        главных компонент. Когда их число мало,
        модель плохо приближает обучающий
        набор и при увеличении сложности
        модели RMSEC монотонно уменьшается.
        Однако качество прогноза на
        проверочный набор может при этом
        ухудшаться (U-образная форма RMSEP). Точка
        минимума RMSEP, или начало плато,
        соответствует оптимальному числу
        главных компонент. Проблема
        сбалансированности описания данных
        рассматривается во многих работах <a href="http://www.chemometrics.ru/materials/articles/HOC200407/">
        А. Хоскюлдссона</a>, который в 1988 году
        ввел новую концепцию моделирования – так называемый
        <a href="references.htm#L4.5"> H-принцип</a>. Согласно
        этому принципу точность моделирования
        (RMSEC) и точность прогнозирования (RMSEP)
        связаны между собой. Улучшение RMSEC
        неминуемо влечет ухудшение RMSEP, поэтому
        их нужно рассматривать совместно.
        Именно по этой причине множественная
        линейная регрессия, в которой всегда
        участвует явно избыточное число
        параметров, неизбежно приводит к
        неустойчивым моделям, непригодным для
        практического применения.
        <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		<a name="Ch1.7"></a></span><h2 align="left">1.7.
      Мультиколлинеарность</h2>
        <p align="left">Рассмотрим задачу
        множественной линейной калибровки&nbsp;
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="40">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq10"></a>&nbsp;</b><b>Y </b>= <b>XB
                </b>.</td>
              <td>
                <p align="center">(10)</td>
            </tr>
          </table>
          </center>
        </div>
        <p align="left">Разумеется, здесь мы имеем
        дело с обучающим набором данных. Мы не
        пишем индекс у матриц (<b>Y</b><sub>с</sub>, <b>X</b><sub>с</sub>)
        только для простоты обозначений.
        Классическое решение этой задачи
        находится с помощью <a href="statistics.htm#Ch7.3">метода наименьших
        квадратов</a>. Минимизируя сумму квадратов
        отклонений (<b>Y</b> – <b>XB</b>)<sup>t</sup>(<b>Y</b> – <b>XB</b>),
        получаем оценки неизвестных
        коэффициентов <b> B</b> –
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq11"></a>&nbsp;</b>.<img border="0" src="calibration/image020.gif" width="115" height="29"></td>
              <td>
                <p align="center">(11)</td>
            </tr>
          </table>
          </center>
        </div>
        <p align="left">Далее находится –&nbsp;
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq12"></a>&nbsp;</b>.<img border="0" src="calibration/image021.gif" width="56" height="21"></td>
              <td>
                <p align="center">(12)</td>
            </tr>
          </table>
          </center>
        </div>
      <p align="left">&nbsp;– оценка искомых откликов.
      Главная проблема при таком классическом
      подходе – это обращение матрицы <b>X</b><sup>t</sup><b>X</b>
      . Очевидно, что если число стандартных
      образцов меньше, чем число переменных (<i>I</i>&lt;<i>J</i>)
      то то обратной матрицы не существует.
      Более того, даже при достаточно большом
      числе образцов (<i>I</i>&gt;<i>J</i>), обратной
      матрицы может и не быть. Рассмотрим
      простейший пример.<a name="Fig09"></a>
        <p align="center">
		<img src="calibration/Fig09.png" width="623" height="360"><p align="center"><samp>Рис.9
      Пример коллинеарных данных</samp></p>
      <p align="left">На <a href="#Fig09">Рис. 9</a>
      представлены данные, в которых всего три
      образа (<i>I</i>=3) и две переменные (<i>J</i>=2).
      Используя активный элемент на <a href="calibration/Calibration.xls#Multicollinearity!B1">листе</a>,
      угол между векторами 1 и 2 можно изменять
      от 90<sup>о</sup> до 0<sup>о</sup>. Чем меньше угол,
      тем меньше детерминант матрицы <b>X</b><sup>t</sup><b>X</b>
      и тем хуже определяется матрица (<b>X</b><sup>t</sup><b>X</b>)<sup>–1</sup>.
      В предельном случае, когда угол между
      векторами равен 0<sup>о</sup>, матрица <b>X</b><sup>t</sup><b>X</b>
      не может быть обращена. При этом векторы
      1 и 2 колинеарны, т.е. они лежат на одной
      прямой, совпадающей с вектором 3.
      Анимация на <a href="#Fig10"> Рис. 10</a> иллюстрирует суть
      проблемы – невозможность построения
      калибровки классическим способом, когда
      данные коллинеарны. <a name="Fig10"></a>
        <p align="center"><img border="0" src="calibration/Fig10.gif" width="517" height="503"><p align="center"><samp>Рис.10
      Пример коллинеарных данных</samp></p>
        <p align="left">В многомерной калибровке (т.е.
        при <i>J</i>&gt;&gt; 1), мы все время
        сталкиваемся с <i><a href="references.htm#L1.1"> мультиколлинеарностью</a></i> –
        множественными связями между
        векторами X-переменных, приводящими к
        той же проблеме – невозможности
        обращения матрицы&nbsp; <b>X</b><sup>t</sup><b>X</b>.
        Далее мы увидим, что можно сделать в
        случае мультиколлинеарности данных.
        <p align="left"><a href="#Contents">Содержание</a> <a name="Ch1.8"></a>
        <h2 align="left">1.8. Подготовка данных</h2>
      <p align="left">Важным условием правильного
      моделирования и, соответственно,
      успешного анализа, является
      предварительная подготовка данных,
      которая включает различные
      преобразования исходных, &quot;сырых&quot;
      экспериментальных значений.
      Простейшими преобразованиями является
      центрирование и нормирование.&nbsp;
        <p> <i> Центрирование</i> – это вычитание
        из исходной матрицы <b>X</b> матрицы <b>M</b>,
        т.е.</p>
        <p align="center">&nbsp;<img border="0" src="calibration/image022.gif" align="bottom" width="75" height="21"></p>
        <p>Обычно усреднение проводится по
        столбцам: для каждого вектора <b>x</b><i><sub>j</sub></i>
        вычисляется среднее значение –</p>
        <p align="center"><img border="0" src="calibration/image023.gif" width="139" height="29">.</p>
<p align="center">&nbsp;</p>
        <p>Тогда <b>M</b>=(<i>m</i><sub>1</sub><b>1</b>,..., <i>m</i><sub><i>J</i></sub><b>1</b>),
        где <b>1</b> – это вектор из единиц
        размерности <i>I</i>.</p>
      <p>Центрирование – это почти обязательная
        процедура перед применением
        проекционных методов. Второе
        простейшее преобразование данных, <i>
        нормирование</i>, не является обязательным.
        Нормирование, в отличие от
        центрирования, не меняет структуру
        данных, а просто изменяет вес различных
        частей данных при обработке. Чаще всего
        применяется нормирование по столбцам –
        это умножение исходной матрицы <b>X</b>
        справа на матрицу <b>W</b>, т.е. &nbsp;</p>
        <p align="center"><img border="0" src="calibration/image024.gif" width="61" height="23"></p>
      <p>Матрица <b>W</b> – это диагональная
        матрица размерности <i>J</i>&times;<i>J</i>.
        Обычно диагональные элементы <i>w<sub>jj</sub></i>
        равны обратным значениям стандартного
        отклонения&nbsp; –&nbsp;</p>
        <p align="center"><img border="0" src="calibration/image025.gif" width="151" height="53">,</p>
        <p>вычисленным для каждого столбца <b>x</b><i><sub>j</sub></i>.
        Нормирование по строкам (называемое
        также нормализацией) – это умножение
        матрицы <b>X</b> слева на диагональную
        матрицу <b>W</b>, т.е.</p>
        <p align="center"><img border="0" src="calibration/image026.gif" width="61" height="23">.</p>
        <p align="left">При этом размерность <b>W</b>
        равна <i>I</i>&times;<i>I</i>, а ее элементы <b>w</b><sub><i>ii</i></sub>
        – это обратные значения стандартных
        отклонений строк <b>x</b><sub>i</sub><sup>t</sup>.</p>
        <p align="left">Комбинация центрирования и
        нормирования по столбцам </p>
        <p align="center"><img border="0" src="calibration/image027.gif" width="116" height="25"></p>
        <p align="left">называется <i> автошкалированием</i>.
        Нормирование данных часто применяют
        для того, чтобы уравнять вклад в модель
        от различных переменных (например, в
        гибридном методе ЖХ-МС), учесть
        неравномерные погрешности, или для
        того, чтобы обрабатывать совместно
        разные блоки данных. Нормирование
        также можно рассматривать как метод,
        позволяющий стабилизировать
        вычислительные алгоритмы. В тоже время,
        к этому преобразованию нужно
        относиться с большой осторожностью, т.к.
        оно может сильно исказить результаты
        качественного анализа. Любое
        преобразование данных – центрирование,
        шкалирование, и т.п. – всегда делается
        сначала на обучающем наборе. По этому
        набору находятся значения&nbsp; <i>m<sub>j</sub> </i>и
        <i>d</i><sub><i>j</i></sub>, которые затем
        применяются и к обучающему, и к
        проверочному набору</p>
        <p align="left"><a href="#Contents">Содержание</a><a name="Ch2"></a>
        <h1 align="left">2. Модельные данные <a name="Ch2.1"></a></h1>
        <h2 align="left">2.1.&nbsp;Принцип линейности</h2>
      <p align="left">Для иллюстрации и сравнения
      различных методов калибровки будем
      использовать модельный пример, в
      котором &quot;экспериментальные&quot; данные
      мы создадим сами. Прообразом для этого
      примера служит популярная задача
      анализа спектральных данных. Известно,
      что в таких экспериментах хорошо
      выполняется принцип линейности. Пусть
      имеются два вещества <font face="Arial"> A</font> и <font face="Arial"> B</font>, смешанные в
      концентрациях <i>c</i><sub>A</sub> и <i>c</i><sub>B</sub>.
      Тогда спектр смеси есть –&nbsp;<p align="center">X = <i>c</i><sub>A</sub>·<i>S</i><sub>A</sub>+
      <i>c</i><sub>B</sub>·<i>S</i><sub>B</sub>,&nbsp;<p align="left">где <i>S</i><sub>A</sub>
      и <i>S</i><sub>B</sub> – спектры чистых веществ.
      Заметим, что тот же принцип линейности
      выполняется и в хроматографии, где в
      роли &quot;спектров&quot; выступают
      хроматографические профили чистых
      компонент смеси.<p align="left"><a href="#Contents">Содержание</a><a name="Ch2.2"></a><h2 align="left">2.2. &quot;Чистые&quot; спектры&nbsp;</h2>
      <p align="left">Для моделирования &quot;чистых&quot;
      спектров <i>S</i>(&#955;) мы
      использовали гауссовы пики –&nbsp;
        <p align="center"><img border="0" src="calibration/image028.gif" width="181" height="56">,&nbsp;
        <p align="left">где <i>S</i><sub>0</sub>, <i>m</i>, <i>v</i> – это
        параметры спектров, а&nbsp;&#955;<span lang="en-us"><span class="style5">
		</span></span>=<span lang="en-us"> </span>0,
        1, 2, …, 100 – это условный номер канала (длина
        волны, время удерживания, и т.п.). На <a href="#Fig11"> Рис.
        11</a> показаны спектры трех веществ: <font face="Arial"> A</font>,
        <font face="Arial"> B</font> и <font face="Arial"> C</font>,
        которые участвуют в примере. Вещества <font face="Arial"> A</font>
        и <font face="Arial"> B</font> – это искомые величины (отклики), а
        компонент <font face="Arial"> C</font> добавлен в систему как шум,
        т.е. нежелательная примесь.<a name="Fig11"></a>
        <p align="center">
		<a href="calibration/Calibration.xls#'Pure Spectra'!A1">
		<img src="calibration/Fig11.png" width="406" height="450" class="style5"></a>&nbsp;<p align="center"><samp>Рис.11
      Чистые спектры</samp></p>
        <p align="left">Видно, что спектры сильно
        перекрываются, особенно <font face="Arial"> A</font> и
        <font face="Arial"> B</font>, у которых
        нет участков, где бы присутствовал
        только один сигнал. Это обстоятельство
        сильно мешает построению калибровок
        классическими способами.<p align="left">Чистые спектры можно изменить, 
задавая новые величины в ячейках <span class="address"><span lang="en-us">B4:D6</span></span>, 
которые соответствуют параметрам формы гауссовых пиков. Например &quot;растащить&quot; 
спектры&nbsp; <font face="Arial"> A</font> и
        <font face="Arial"> B</font> так&nbsp;чтобы они мало перекрывались и 
посмотреть, что из этого получится. <p align="left"><a href="#Contents">Содержание</a><a name="Ch2.3"></a><h2 align="left">2.3.&quot;Стандартные&quot; образцы</h2>
      <p align="left">Для создания модельных данных
      мы должны задать концентрации всех
      компонентов в системе для различных
      образцов. Будем считать, что у нас
      имеется 14 образцов, из которых девять – это
      <a href="calibration/Calibration.xls#Ycal"> обучающий</a> набор, а пять
      – это <a href="calibration/Calibration.xls#Ytst">
      проверочный</a> набор. Значения
      концентраций представлены на <a href="#Fig12"> Рис.
      12</a>. <a name="Fig12"></a>
        <p align="center">
		<a href="calibration/Calibration.xls#Concentrations!A1">
		<img src="calibration/Fig12.png" width="712" height="357" class="style5"></a>&nbsp;<p align="center"><samp>Рис.12
      Концентрации в обучающем и проверочном
      наборах</samp></p>
      <p align="left">Заметим, что среди этих
      образцов нет ни одного &quot;чистого&quot;, т.е.
      такого в котором все концентрации, кроме
      одной (например, <font face="Arial">A</font>) , равны нулю. Это тоже
      &quot;мешает&quot; использованию
      традиционных методов калибровки.&nbsp;<p align="left"><a href="#Contents">Содержание</a><a name="Ch2.4"></a><h2 align="left">2.4.
      Создание X данных</h2>
      <p align="left">Для получения
      &quot;экспериментальных спектров&quot; надо
      матрицу концентраций <b>C</b> умножить на
      матрицу чистых спектров <b>S</b> и добавить
      к результату случайные ошибки
      (погрешности) –&nbsp;
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="40">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq13"></a>&nbsp;X </b>= <b>CS+E
                </b>.</td>
              <td>
                <p align="center">(13)</td>
            </tr>
          </table>
          </center>
        </div>
      <p align="left">На <a href="#Fig13"> Рис. 13</a> представлены
      полученные спектры в <a href="calibration/Calibration.xls#Xcal"> обучающем</a> и
      <a href="calibration/Calibration.xls#Xtst">
      проверочном</a> наборах. Погрешности
      моделировались со стандартным
      отклонением 0.015.<a name="Fig13"></a>
        <p align="center"><a href="calibration/Calibration.xls#Data!A1">
		<img src="calibration/Fig13.png" width="927" height="514" class="style5"></a>&nbsp;<p align="center"><samp>Рис.13
      Создание модельных данных</samp></p>
      <p align="left">Генерация случайных ошибок производится с помощью простого
		<a href="excel.htm#Ch4.3">
		<span lang="en-us">VBA </span>макроса</a> , который запускается кнопкой
		<b>
		<span style="font-family: Arial; background: none repeat scroll 0% 0% silver;" lang="EN-US">
		Add New Error</span></b><span lang="en-us">. </span>Величина желаемой 
		погрешности (<a href="statistics.htm#Ch1.5">СКО</a>) предварительно задается в ячейке <span lang="en-us">
		<span class="address">E18</span> </span>с именем<span lang="en-us">
		<span class="address">RMSE</span></span>, озаглавленной
		<span class="address">Designed err<span lang="en-us">or</span></span><span lang="en-us">.
		</span>Погрешность, которая получилась в результате генерации случайных 
		чисел выводится в ячейку <span lang="en-us"><span class="address">J18</span></span>, 
		озаглавленную <span class="address"><span lang="en-us">Obtained</span>
		<span lang="en-us">error</span></span><span lang="en-us">.</span> 
<p align="left">Генерируя новые данные можно узнать много интересного о методах 
калибровки. 
<p align="left"><a href="#Contents">Содержание</a><a name="Ch2.5"></a><h2 align="left">2.5.
      Центрирование данных</h2>
      <p align="left">В соответствие с концепцией,
      изложенной в <a href="#Ch1.8">разделе 1.8</a>, данные нужно правильно 
		подготовить. В рассматриваемом
      модельном примере нет необходимости в
      выравнивании переменных – все
      спектральные каналы имеют схожие
      величины сигналов. А вот центрирование,
      как спектров <b>X</b>, так и откликов <b>Y</b> ,
      бывает необходимо для построения некоторых
      моделей.<p align="left">Для центрирования
      концентраций <b>Y</b> вычисляются средние по обучающему набору.
      Эти средние затем вычитаются из всех
      значений <b>Y. </b>&nbsp;Аналогично проводится и
      центрирование в данных <b>X</b> – вычисляются средние значения для
      каждого канала по обучающему набору и
      затем эти значения вычитаются из всех
      величин <b>X</b> – по столбцам. 
      <p align="left"><a href="#Contents">Содержание</a><a name="Ch2.6"></a><h2 align="left">2.6.
      Обзор данных</h2>
      <p align="left">Итак, мы построили модельные
      данные (<b>Y</b>, <b>X</b>): концентрации – матрицу <b>Y</b> размером (14&times;2) и спектры
      – матрицу <b>X</b> размером (14&times;101). Исследуя
      эти данные, мы &quot;забудем&quot; (т.е. не
      будем использовать в расчетах) то, что в
      системе присутствует еще одно &quot;скрытое&quot;
      вещество <font face="Arial">C</font>. Интересно, сможем ли мы
      обнаружить его присутствие? Кроме того,
      не будут использоваться и спектры
      чистых веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, примененные для
      построения данных. Мы постараемся их
      восстановить и сравнить с исходными
      спектрами.&nbsp;<p align="left">Все данные мы
      разделили на два блока: обучающий (или
      калибровочный) – 9 образцов, и
      проверочный (или тестовый) – 5 образцов.
      Мы будем строить калибровки с помощью
      разных методов, используя только первый,
      обучающий набор. Второй, проверочный
      набор послужит для оценки качества
      получаемых моделей.<p>Данные используются для иллюстрации и сравнения 
различных методов калибровки. Они размещены в рабочей книге <span lang="en-us">
Excel </span>с именем <span lang="en-us"><em>
<a href="calibration/Calibration.xls">Calibration.xls</a></em>.</span>Эта книга 
&nbsp;включает в себя следующие листы:</p>
<p><a href="calibration/Calibration.xls#Intro!C4"><span lang="en-us"><em>I</em></span><em>ntro</em></a>: 
краткое введение</p>
<p><a href="calibration/Calibration.xls#Layout!A1"><em>L</em><em><span lang="en-us">ayout</span></em></a>: 
схемы, объясняющая имена массивов, используемых в примере</p>
<p><em><a href="calibration/Calibration.xls#Gun!A1">G<span lang="en-us">un</span></a></em>: 
иллюстрация пере - и недооценки в калибровке</p>
<p><em><a href="calibration/Calibration.xls#Multicollinearity!A1">M<span lang="en-us">ulticollinearity</span></a></em>: 
иллюстрация проблемы мультиколлинеарности в калибровке</p>
<p><em><a href="calibration/Calibration.xls#'Pure Spectra'!A1">Pure Spectra</a></em>: 
истинные чистые спектры S&nbsp; </p>
<p><em><a href="calibration/Calibration.xls#Concentrations!A1">Concentrations</a></em>: 
истинные концентрационные профили C</p>
<p><em><a href="calibration/Calibration.xls#Data!A1">Data</a></em>: модельные 
данные, используемые в примере.. </p>
<p><em><a href="calibration/Calibration.xlss#UVR!A1">UVR</a></em>: одноканальная 
калибровка</p>
<p><em><a href="calibration/Calibration.xls#Vierordt!A1">Vierordt</a></em>: 
калибровка методом Фирордта</p>
<p><em><a href="calibration/Calibration.xls#Indirect!A1">Indirect</a></em>: 
непрямая калибровка</p>
<p><em><a href="calibration/Calibration.xls#MLR!A1">MLR</a></em>: множественная 
линейная регрессия</p>
<p><em><a href="calibration/Calibration.xls#SWR!A1">SWR</a></em>: калибровка 
пошаговой реегрессией</p>
<p><em><a href="calibration/Calibration.xls#PCR!A1">PCR</a></em>: регрессия на 
главные компоненты&nbsp; </p>
<p><em><a href="calibration/Calibration.xls#PLS1!A1">PLS1</a></em>: метод 
проекция на латентные переменные 1 </p>
<p><em><a href="calibration/Calibration.xls#PLS2!A1">PLS2</a></em>: метод 
проекция на латентные переменные 2&nbsp; </p>
<p><span lang="en-us"><a href="calibration/Calibration.xls#Compare!A1">Compare</a>
</span>сравнение различных методов<span lang="en-us"> </span></p>
<p align="left"><a href="#Contents">Содержание</a><a name="Ch3"></a>
        <h1 align="left">3. Классическая калибровка </h1>
<p align="left">Классическая калибровка опирается на использовании того же 
принципа линейности, по которому строились модельные данные, т.е. на уравнение (<a href="#Eq13">13</a>)&nbsp;</p>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="40">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq14"></a>&nbsp;X</b>=<b>СS</b></td>
              <td>
                <p align="center">(14)</td>
            </tr>
          </table>
          </center>
        </div>
        <p align="left">Здесь<b> <span lang="en-us">X</span>=X</b><sub>c</sub> и <b>
		<span lang="en-us">C=</span>Y</b><sub>c</sub>
        – это обучающая часть исходных данных (не
        центрированных), а <b>S</b> – это
        матрица &quot;чистых
        спектров&quot; (она же матрица чувствительности).
        <p align="left">Если матрица <b>S</b> известна<span lang="en-us"> </span>
		априори, то концентрации определяются так<div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="40">
            <tr>
              <td width="90%">
                <p align="center"><b><span lang="en-us">C</span></b>=<b><span lang="en-us">X</span>S<sup><span lang="en-us">+</span></sup></b></td>
              <td>
                <p align="center">&nbsp;</td>
            </tr>
          </table>
          </center>
        </div>
        <p align="left">где <b>S<sup>+</sup></b> <span lang="en-us">= =<strong>S</strong><sup>t</sup>(<strong>SS</strong><sup>t</sup>)</span><sup>&#8722;1</sup>– это
        <a href="matrix.htm#ch115">псевдообратная матрица</a><span lang="en-us">.
		</span>Этот случай называется <em>прямой</em> калибровкой. Однако, на 
		практике матрица чистых спектров, как правило, неизвестна и ее 
		приходится восстанавливать из обучающих данных.&nbsp;<p align="left"><a href="#Contents">Содержание</a><a name="Ch3.1"></a>&nbsp;<h2 align="left">
3,1. Калибровка по одному каналу (однофакторная)</h2>
        <p align="left">Это самый простой, наивный вид
        калибровки. Если для каждого аналита из всех данных <b>X</b>
        выделить один канал (длину волны),
        то получится несколько векторов <b><span lang="en-us">x</span></b>. Тогда, используя обучающие данные, можно построить 
		для каждого вещества
        простейшую одномерную регрессию –
        <p align="center"><i><span lang="en-us">x</span></i>=<i><span lang="en-us">sc</span></i>+<i>b</i> ,&nbsp;<p align="left">одну для вещества
      <font face="Arial"> A</font> (<span lang="en-us"><em>c</em></span>=<i>c</i><sub>A</sub>), 
а другую для <font face="Arial"> B</font> (<span lang="en-us"><em>c</em></span>=<i>c</i><sub>B</sub>).
        Формулы для оценивания коэффициентов <i><span lang="en-us">s</span></i>
        <span lang="en-us">(</span>наклон)и <i>b</i> (отсечение) можно найти в любом пособии по
        линейной регрессии, например, <a href="statistics.htm#Ch7.2">здесь</a>.
        В Excel это проще
        всего сделать с помощью функции <a href="excel.htm#Ch2.7">ЛИНЕЙН</a><span lang="en-us"> 
(LINEST). </span>После того, как эти коэффициенты найдены, значения концентраций 
можно вычислять по уравнению<p class="style7"><span lang="en-us"><em>c</em>=(<em>x</em></span>–<span lang="en-us"><em>b</em>)/<em>s</em></span>&nbsp;<p align="left">На 
Рис.14 приведен пример построения
        двух этих регрессий для каналов 31 (<font face="Arial">A</font>) и 98 (<font face="Arial"><span lang="en-us">B</span></font>).
        График показывает, как проходят линии
        регрессий для веществ <font face="Arial"> A</font> и
      <font face="Arial">B</font>.<p align="center"><a href="calibration/Calibration.xls#UVR!B1">
		<img src="calibration/Fig14.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.14
      Калибровка по одному каналу)</samp></p>
        <p align="left">Обратите внимание, что в каждом калибровочном уравнении 
		присутствует свободный член <span lang="en-us"><em>b</em>.</span> Это 
		противоречит исходному уравнению (<a href="#Eq13">13</a>), но зато 
		позволяет учесть влияние фона, или, как в нашем случае, присутствие 
		посторонней примеси (вещества <font face="Arial"> <span lang="en-us">C</span></font>)<span lang="en-us">.</span>&nbsp;Величины 
		коэффициентов <span lang="en-us"><em>s</em> </span>(наклон) 
		соответствуют значениям &quot;чистых&quot; спектров. На Рис. 15 показаны &quot;чистые&quot; 
		спектры веществ <font face="Arial"> A</font> и
      <font face="Arial">B</font> и соответствующие значения коэффициентов
		<span lang="en-us"><em>m</em>.</span><p align="center">
<img src="calibration/Fig15.png">&nbsp;<p align="center"><samp>
Рис.15 &quot;Чистые&quot; спектры и их оценки для выбранных каналов</samp></p>
        <p align="left">Для визуальной оценки качества
      калибровки традиционно используются
      графики &quot;измерено-предсказано&quot;, в
      которых по оси абсцисс откладываются
      известные (стандартные) концентрации<i> y</i>,
      а по оси ординат соответствующие им
      величины оценок 
		<img border="0" src="calibration/image036.gif" align="texttop" class="style1">,
      найденные (предсказанные) с помощью
      построенной калибровки. Такие графики
      показаны на Рис. 1<span lang="en-us">6</span>. Помимо
      вышеупомянутых данных (точки), на таких
      графиках обычно показывают линии
      регрессии <i><span lang="en-us">k</span>y</i>+<i>b</i>. Коэффициенты 
		<span lang="en-us"><i>k</i> </span>(наклон)
      и <i>b</i> (отсечение) характеризуют &quot;качество&quot;
      калибровки. В идеальном случае <i><span lang="en-us">k</span></i>=1 и <i>b</i>=0.
      Чем дальше от идеала, тем хуже
      калибровка. Кроме того, на таких
      графиках обычно приводится значение
      <a href="statistics.htm#Ch3.6">коэффициента корреляции</a> <i>R</i><sup>2</sup>
      между <i>y</i> и 
		<img border="0" src="calibration/image036.gif" align="texttop" class="style1">&nbsp; <a name="Fig16"></a>
        <p align="center"><a href="calibration/Calibration.xls#UVR!J54">
		<img src="calibration/Fig16.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.<span lang="en-us">16</span>
      Графики &quot;измерено-предсказано&quot; для
      однофакторной калибровки. Обучающий и
      проверочный наборы</samp></p>
        <p align="left">В Табл. <span lang="en-us">1</span> приведены
        характеристики качества однофакторной
        калибровки веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, вычисленные в
        соответствие с формулами <a href="#Ch1.4">раздела
        1.4.</a> <span lang="en-us">&nbsp;</span><a name="Tab01"></a><p align="center"><samp>Табл. <span lang="en-us">1</span> Характеристики
        качества однофакторной калибровки&nbsp;</samp>
        <p align="center"><a href="calibration/Calibration.xls#UVR!s2">
		<img src="calibration/table01.png" class="style5"></a>&nbsp;<p align="left">Разумеется одномерную
      калибровку можно проводить по любому
      каналу. На листе <i> UVR</i> для этого достаточно изменить значения в 
ячейках <span lang="en-us"><span class="address">C2</span> </span>и<span lang="en-us">
<span class="address">D2</span></span>, которые соответствуют двум каналам – для 
веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>. и проверить 
как меняется качество калибровки. Так
      наилучшее значение RMSEP=0.<span lang="en-us">1</span>73 для вещества <font face="Arial"> A</font> 
      достигается при калибровке по 31 каналу, а наихудшее значение RMSEP=0.<span lang="en-us">7</span>02 
получается при &#955; =97.
      Соответственно для вещества <font face="Arial"> B</font> имеем: наилучшее 
значение RMSEP=0.15<span lang="en-us">1</span>
      для &#955; =98 и наихудшее RMSEP=0.611 для &#955; =20. </p>
<p align="left">Существует мнение, что калибровку лучше проводить в точке, 
где соответствующий &quot;чистый спектр&quot; имеет максимум. Из рассмотренного примера 
видно, что это не так. В точке &#955; =45 (максимум <font face="Arial"> A</font>) 
RMSEP=0.<span lang="en-us">2</span>05, а в точке &#955; =55 (максимум
<font face="Arial"> <span lang="en-us">B</span></font>) RMSEP=0<span lang="en-us">.484.
</span>&nbsp;</p>
        <p align="left"><a href="#Contents">Содержание</a><a name="Ch3.2"></a></p>
      <h2 align="left">3.2. Метод Фирордта</h2>
        <p align="left">Впервые задача анализа спектрофотометрических данных 
		была рассмотрена в работе Карла фон Фирордта (<font size="3" face="Times New Roman"><span lang="EN-US" style="font-size:12.0pt;line-height:150%;mso-ansi-language:EN-US"><a href="http://en.wikipedia.org/wiki/Karl_von_Vierordt">Karl<span lang="ru">
		</span>von<span lang="ru"> </span>Vierordt</a></span><span style="font-size:12.0pt;line-height:150%;mso-ansi-language:EN-US"><o:p>)</o:p></span></font> 
		в 1873 г. Исследуя изменения гемоглобина в крови, он предложил метод 
		калибровки, который и теперь, спустя 140 лет, еще очень популярен у 
		некоторых аналитиков.
<p align="left">Метод Фирордта похож на метод одноканальной калибровки. В нем 
также выбирается по одному каналу для каждого вещества, но регрессионные 
уравнения рассматриваются не независимо, а совместно<p class="style7">
<img src="calibration/image028a.gif" width="67" height="27"><p align="left">
Здесь матрица 
<img src="calibration/image029a.gif" width="23" height="27" class="style1">имеет столько 
столбцов, сколько определяется веществ (у нас 2), матрица <b><span lang="en-us">
Y</span></b><sub><span lang="en-us">c</span></sub> –&nbsp;это известные 
значения концентраций в обучающем наборе (у нас 2), а матрица <b>S</b> – это 
неизвестная квадратная ( у нас 2&times;2) матрица чувствительности, которую нужно 
оценить. Заметим, что в традиционном методе Фирордта свободный член отсутствует 
в полном согласии с уравнением (<a href="#Eq13">13</a>),
<p align="left">Для оценки матрицы чувствительности<b> S</b>&nbsp;умножим это 
уравнение слева на транспонированную матрицу концентраций <b>Y</b><sub>c</sub>
        <p align="center">
		<img border="0" src="calibration/image029.gif" width="101" height="27" class="style1">
        <p align="left">Тогда матрица –&nbsp;
        <p align="center"><img border="0" src="calibration/image030.gif"><p align="left">будет оценкой матрицы чувствительности. 
<p align="left">На Рис. 17 показано применение метода Фирордта для модельного 
примера, где для калибровки выбраны два канала 29 и 100. <a name="Fig17"></a>
        <p class="style7"><a href="calibration/Calibration.xls#Vierordt!B3">
		<img src="calibration/Fig17.png" class="style5"></a><p align="center"><samp>Рис.17 
Применение метода Фирордта</samp></p>
        <p align="left">
График &quot;предсказано-измерено&quot; представляет результаты калибровки сигнала 
(спектров <span lang="en-us"><strong>x</strong>) </span>для выбранных каналов. 
Элементы матрицы чувствительности <span lang="en-us"><strong>S</strong> </span>
соответствуют значениям матрицы &quot;чистых&quot; спектров. На Рис. 18 показано это 
соответствие.  
      <a name="Fig18"></a>  
<p class="style7"><a href="calibration/Calibration.xls#Vierordt!C53">
<img src="calibration/Fig18.png" class="style5"></a><p align="center"><samp>Рис.18 
Элементы матрицы чувствительности <span lang="en-us"><strong>S</strong> </span>
(точки) в методе Фирордта и &quot;чистые&quot; спектры</samp></p>
<p align="left">
Для оценки и предсказания значений концентрации веществ <font face="Arial"> A </font>и
      <font face="Arial"> B</font>. нужно вычислить матрицу обратную к матрице 
чувствительности <span lang="en-us"><strong>S</strong>. </span>Сделать это 
просто, т.к. эта матрица квадратная<span lang="en-us">. </span>Тогда матрица<span lang="en-us">
<strong>V</strong></span><p class="style7">
<img src="calibration/image030a.gif">&nbsp;<p align="left">будет линейным &quot;оценивателем&quot;
        матрицы концентраций <b>Y</b>. Для того,
        чтобы найти оценки величин
        концентраций в обучающем наборе, надо
        матрицу <b>V</b> умножить на матрицу
        соответствующих спектров 
<img src="calibration/image029a.gif" class="style11">
        –&nbsp;
        <p align="center">
		<img src="calibration/image030b.gif" width="71" height="27">
        <p align="left">Аналогично, для оценки
        концентраций в проверочном наборе,
        матрица <b>V</b>
        умножается на <b>X</b><sub>t</sub>  –
        <p align="center">
		<img src="calibration/image030c.gif" width="69" height="27">&nbsp;<p class="style8">
		Графики &quot;предсказано-измерено&quot; показаны на Рис. 19 <a name="Fig19"></a>
        &nbsp;<p align="center">
<a href="calibration/Calibration.xls#Vierordt!А76">
<img src="calibration/Fig19.png" class="style5"></a><p align="center"><samp>Рис.19
      Графики &quot;измерено-предсказано&quot; для
      метода Фирордта. Обучающий и
      проверочный наборы</samp></p>
        <p align="left">В Табл. <span lang="en-us">2</span> приведены
        характеристики качества калибровки по методу Фирордта веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, вычисленные в
        соответствие с формулами <a href="#Ch1.4">раздела
        1.4.</a> <a name="Tab02"></a>
        <span lang="en-us">&nbsp;</span><p align="center"><samp>Табл. <span lang="en-us">2</span> Характеристики
        качества калибровки&nbsp;</samp>
        <samp>по методу Фирордта </samp>
        <p align="center"><a href="calibration/Calibration.xls#Vierordt!U6">
		<img src="calibration/table02.png" class="style5"></a><p class="style8">
Качество калибровки сильно зависит от того, какие каналы выбраны в качестве 
аналитических. Часто рекомендуется действовать таким образом. Строится график
<span lang="en-us">F(</span>&#955;<span lang="en-us">)= s<sub>A</sub></span>/<span lang="en-us">s<sub>B</sub></span> 
, где <span lang="en-us">s<sub>A</sub></span>и <span lang="en-us">s<sub>B</sub></span> 
– это &quot;чистые спектры&quot;. На нем определяют такие точки &#955;<sub>1</sub><span lang="en-us">
</span>и &#955;<sub>2</sub>, в которых разница <span lang="en-us">|F(</span>&#955;<sub>1</sub><span lang="en-us">)
</span>–<span lang="en-us"> F(</span>&#955;<sub>2</sub><span lang="en-us">)| </span>
максимальна. Способ правильный, но построить график <span lang="en-us">F(</span>&#955;<span lang="en-us">)</span>, 
не зная чистых спектров, невозможно. 
<p align="left"><a href="#Contents">Содержание</a><a name="Ch3.3"></a></p>
      <h2 align="left">3.3. 
Непрямая калибровка&nbsp;</h2>
        <p align="left">В методе Фирордта. для калибровки используются несколько 
		каналов – столько, сколько веществ нужно определить. Естественно 
		обобщить этот подход, задействовав все имеющиеся у нас обучающие данные.
        <p align="left">Будем рассматривать полное&nbsp;уравнение классической 
		калибровки
        <p class="style7"><b>X</b>=<b>СS</b>&nbsp;<p align="left">Также как в методе 
Фирордта умножим его слева на
        транспонированную матрицу <b>Y</b><sub>c</sub>
        <p align="center">
		<img src="calibration/image030d.gif" width="101" height="27">
        <p align="left">Тогда матрица –&nbsp;
        <p align="center">
		<img src="calibration/image030e.gif" width="121" height="31">&nbsp;<p align="left">является оценкой матрицы &quot;чистых
        спектров&quot;. Заметим, что это уже не квадратная матрица – она имеет 
размерность <span lang="en-us"><em>A</em></span>&times;<span lang="en-us"><em>J</em> (</span>В 
нашем примере 2&times;101). Сравним ее с исходной
        матрицей чистых спектров <font face="Arial"> A </font>и
      <font face="Arial"> B</font>.<p align="left">На
      <a href="#Fig16">Рис. 16</a> показаны исходные и
      восстановленные спектры. Различие между
      ними особенно заметно в той области, где
      велик вклад от примеси <span class="address">C</span>. На краях – там,
      где спектр <span class="address">C</span> стремится к нулю (при &#955;&lt;20
      и &#955;&gt;60) – спектры <font face="Arial"> A</font> и
      <font face="Arial"> B</font>
      восстановлены практически идеально. К
      сожалению, не подозревая о
      существовании в системе вещества <font face="Arial"> C</font>, мы не
      сможем заметить этого факта.
        <p align="center"><a href="calibration/Calibration.xls#Indirect!B1">
		<img src="calibration/Fig20.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.20
      Оценка матрицы &quot;чистых спектров&quot; в
      непрямой калибровке</samp></p>
        <p align="left">Продолжая построение
        калибровки, положим в уравнении (<a href="#Eq14">14</a>)
        <img border="0" src="calibration/image031.gif" align="bottom" class="style1">и
        умножим его справа на матрицу <b>U</b><sup>t</sup>
        –&nbsp;
        <p align="center"><img border="0" src="calibration/image032.gif" width="103" height="27">
        <p align="left">Тогда матрица размерностью (101&times;2)
        –&nbsp;
        <p align="center"><img border="0" src="calibration/image033.gif" width="100" height="29">
        <p align="left">будет линейным &quot;оценивателем&quot;
        матрицы концентраций <b>Y</b>. Для того,
        чтобы найти оценки величин
        концентраций в обучающем наборе, надо
        матрицу <b>V</b> умножить на матрицу
        соответствующих спектров <b>X</b><sub>c</sub>
        –&nbsp;
        <p align="center"><img border="0" src="calibration/image034.gif" width="71" height="27">
        <p align="left">Аналогично, для оценки
        концентраций в проверочном наборе,
        матрица <b>V</b>
        умножается на <b>X</b><sub>t</sub>  –
        <p align="center"><img border="0" src="calibration/image035.gif" width="69" height="27"> <a name="Fig21"></a>
        <p align="center">
		<img src="calibration/Fig21.png" width="790" height="588">&nbsp;<p align="center"><samp>Рис.21
      Оценка концентраций в непрямой калибровке</samp></p>
      <p align="left">В Табл. 3 приведены различные
      характеристики качества прямой
      калибровки веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, вычисленные в
      соответствие с формулами <a href="#Ch1.4">раздела
      1.4.</a> <a name="Tab03"></a><span lang="en-us">&nbsp;</span><span lang="en-us">
		</span>
      <p align="center"><samp>Табл. 3 Характеристики
      качества непрямой калибровки</samp>
      <p align="center">
		<img src="calibration/table03.png" width="329" height="223">
      <p align="left">Бытует устойчивое мнение,
      что классическая калибровка лучше обратной.
      Для объяснения ее преимущества говорят, что она опирается на фундаментальные
      физические принципы, такие как <a href="http://ru.wikipedia.org/w/index.php?title=%D0%97%D0%B0%D0%BA%D0%BE%D0%BD_%D0%91%D1%83%D0%B3%D0%B5%D1%80%D0%B0_%E2%80%94_%D0%9B%D0%B0%D0%BC%D0%B1%D0%B5%D1%80%D1%82%D0%B0_%E2%80%94_%D0%91%D0%B5%D1%80%D0%B0&amp;oldid=6003513">закон
      Ламберта-Бэра</a>. С точки зрения
      математиков, все выглядит наоборот. Во-первых,
      сама калибровка является &quot;обратной&quot;
      по отношению к искомым величинам <b>Y</b>.
      Во-вторых, процедура, с помощью которой
      оцениваются отклики, является
      неустойчивой. Действительно, если между
      искомыми концентрациями A и B имеется
      линейная связь, например <i>c</i><sub>B </sub>~ 0.5<i>c</i><sub>A</sub>,
      то матрица <b>Y</b><sup>t</sup><b>Y</b> не имеет
      обратной, или она обращается с большой
      ошибкой. Линейная связь между искомыми
      концентрациями часто наблюдается при
      анализе объектов окружающей среды, в
      которых она обусловлена естественными
      причинами. В-третьих, классическая калибровка
      не дает нам никаких признаков
      отклонения системы от ее идеальной
      модели, например, не позволяет
      обнаружить примеси (вещество <font face="Arial">C</font>). Наконец,
      далее мы увидим, что и качество такой
      калибровки (точность, прецизионность)
      уступает многим современным методам.
        <p align="left"><a href="#Contents">Содержание</a><a name="Ch4"></a><h1 align="left">4. Обратная калибровка</h1>
      <p align="left">В обратной калибровке основное уравнение имеет 
		вид (<a href="#Eq10">10</a>)<p class="style7"><b>Y </b>= <b>XB</b><p align="left">
в котором. искомая величина <span lang="en-us"><strong>Y</strong> </span>
(концентрация) прямо выражается через известную матрицу спектров
<span lang="en-us"><strong>X</strong>. </span>Хотя такое представление 
калибровочного уравнения и противоречит основному соотношению (<a href="#Eq14">14</a>), 
такой подход обеспечивает лучшее качество моделирования.<p align="left">
<a href="#Contents">Содержание</a><span lang="en-us"><a name="Ch4.1"></a></span><h2 align="left">4.1. Множественная калибровка<span lang="en-us">
</span></h2>
      <p align="left">Простейшим вариантом обратной калибровки является
      <a href="statistics.htm#Ch7.3">множественная линейная
      регрессия</a> (MLR). В <a href="#Ch1.7">разделе 1.7</a> мы
      уже обсуждали свойства MLR в связи с
      проблемой мультиколлинеарности. В
      частности отмечалось, что во
      множественной регрессии число
      переменных должно быть меньше числа
      образцов. В нашем модельном примере
      число калибровочных образцов равно 9,
      поэтому для использования MLR необходимо
      отобрать из 101 канала только 8 и по ним
      строить калибровку. Больше переменных
      взять нельзя, но можно меньше. На листе <i> MLR</i>
      есть <a href="calibration/Calibration.xls#MLR!B1">активный
      элемент</a>, с помощью которого можно
      быстро сменить первый канал; остальные
      изменятся автоматически. <a name="Fig22"></a>
<p align="center"><a href="calibration/Calibration.xls#MLR!B1">
<img src="calibration/Fig22.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.22
      Множественная линейная калибровка</samp></p>
      <p align="left">На Рис. 22 показано как
      отбираются эти каналы – равномерно, с
      шагом 13. Первый канал можно выбрать
      произвольно: от 0 до 9, тогда все
      последующие определяются однозначно. В
      результате этого отбора получается
      матрица независимых переменных <b>X</b>
      размерностью (14&times;8), состоящая из двух
      частей: обучающего набора (9&times;8) и
      проверочного (5&times;8). Используя
      обучающий набор переменных можно
      построить множественную регрессию: (<a href="#Eq10">10</a>)
      между <b>X</b> и <b>Y</b>. Для этого можно
      применить формулы (<a href="#Eq11">11</a>) и (<a href="#Eq12">12</a>),
      но проще воспользоваться функцией
      <span lang="en-us">Excel </span><a href="excel.htm#TREND">ТЕНДЕНЦИЯ</a>. <a name="Fig23"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#MLR!L40">
		<img src="calibration/Fig23.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.23
      Графики &quot;измерено-предсказано&quot; для
      множественной калибровки. Обучающий (a) и
      проверочный (b) наборы</samp></p>
      <p align="left">На Рис. 23 показаны графики &quot;измерено-предсказано&quot;
      для множественной калибровки. Видно, что
      обучающий набор &quot;слишком хорошо&quot;
      описывается моделью. А вот проверка
      неудовлетворительна. Здесь заметно, и
      смещение, и малая корреляция.&nbsp;</p>
      <p align="left">В Табл. 4 приведены
      характеристики качества множественной
      калибровки веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, вычисленные в
      соответствие с формулами <a href="#Ch1.4">раздела
      1.4</a>.<a name="Tabl04"></a><span lang="en-us">&nbsp; </span></p>
      <p align="center"><samp>Табл. 4 Характеристики
      качества множественной линейной калибровки&nbsp;</samp></p>
      <p align="center"><a href="calibration/Calibration.xls#MLR!X7">
		<img src="calibration/table04.png" class="style5"></a>&nbsp;</p>
      <p align="left">Видно, что в этом случае мы
      получили типичную переоценку модели (см.
      <a href="#Ch1.6">раздел 1.6)</a> – число отобранных
      переменных слишком велико. Попытки
      сменить набор переменных ситуацию не
      улучшают. Таким образом множественная
      калибровка является неприемлемым
      методом. Она приводит к переоценке
      модели и дает неудовлетворительные
      результаты при использовании на новом (проверочном)
      наборе образцов.</p>
        <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		</span><a name="Ch4.2"></a></p>
      <h2 align="left"><span lang="en-us">4</span>.<span lang="en-us">2</span>. Пошаговая калибровка</h2>
      <p align="left">Как мы только что видели множественная линейная калибровка неудовлетворительна – она представляет 
		явный пример
      переоценки. В этом разделе мы рассмотрим
      <em>пошаговую калибровку </em>(stepwise regression, SWR),
      в которой отбор переменных является способом справится с переоценкой. Идея метода
      состоит в следующем.&nbsp;</p>
      <p align="left">Пусть имеется калибровочная
      модель, построенная по <i>M</i> отобранным
      каналам. Добавим к ним еще один <i>M</i>+1-ый
      канал. Выбор этого дополнительного
      канала основан на простом принципе – добавляется тот, который дает минимум
      величины RMSEC. Добавление новых каналов
      продолжается до тех пор, пока не
      наступает риск переоценки, т.е. до начала
      роста величины&nbsp; RMSEP (см. <a href="#Ch1.6">раздел 1.6</a>).<a name="Fig24"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#SWR!A1">
		<img src="calibration/Fig24.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.24
      Пошаговая калибровка</samp></p>
      <p align="left">Очевидно, что наилучший
      результат для веществ <font face="Arial"> A</font> и <font face="Arial"> B</font> достигается
      для разных каналов. Поэтому &quot;оптимальные&quot;
      наборы для <font face="Arial"> A</font> и <font face="Arial"> B</font> отличаются. Для
      <font face="Arial"> A</font> – это
      каналы 24<span lang="en-us">,</span> 86<span lang="en-us">,</span> 11<span lang="en-us">,</span> 
		30<span lang="en-us">,</span> …, а для <font face="Arial"> B</font> – это каналы
      100, 10, 95, 39,57, Именно в таком порядке каналы
      добавляются в соответствующие наборы.
      Отбор этих каналов – простая,
      но трудоемкая процедура, которую можно
      упростить, написав небольшой макрос в Excel.&nbsp;</p>
      <p align="left">В пошаговой регрессии
      существует много способов отбора &quot;оптимальных&quot;
      переменных. Тот, который использован
      здесь, самый простой&nbsp;–&nbsp; выбирать тот канал, на котором 
		достигается минимум среднеквадратичной ошибки в обучении,
      RMSEC. <a name="Fig25"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#SWR!B57">
		<img src="calibration/Fig25.png" class="style5"></a>&nbsp;<p align="center"><samp>Рис.25
      Среднеквадратичные остатки обучения (RMSEC)
      и проверки (RMSEP) в пошаговой калибровке</samp></p>
      <p align="left">На Рис. 25 показано, как
      изменяются среднеквадратичные остатки
      в обучении (RMSEC) и в проверке (RMSEP) при
      увеличении числа каналов в SWR. В
      соответствие с принципом минимума RMSEP,
      оптимальное число каналов для вещества <font face="Arial"> B</font>
      – три. Это четко видно на графике. А вот
      выбор числа каналов для вещества <font face="Arial"> A</font>
      затруднителен. На соответствующем
      графике кривая RMSEP не имеет минимума. Так
      часто случается при анализе сложных
      данных. В рассматриваемом примере
      оптимальные каналы для вещества <font face="Arial"> A</font>
      располагаются по краям &quot;спектральной&quot;
      области – там, где влияние скрытой
      примеси <font face="Arial"> C</font> не существенно. Сравните <a href="#Fig11">Рис.
      11 </a>и <a href="#Fig24">Рис. 24</a>. Поэтому SWR
      калибровка для вещества <font face="Arial"> A</font> никак не может
      &quot;заметить&quot; наличие вещества <font face="Arial">C</font>. В
      таком сомнительном случае следует
      выбирать точку излома на графике RMSEP.
      Именно поэтому мы выбираем только два
      канала для вещества A. <a name="Fig26"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#SWR!F65">
		<img src="calibration/Fig26.png" class="style5"></a><p align="center"><samp>Рис.2<span lang="en-us">6</span>
      Графики &quot;измерено-предсказано&quot; для
      пошаговой калибровки. Обучающий и
      проверочный наборы</samp></p>
      <p align="left">На Рис. 2<span lang="en-us">6</span> показаны графики &quot;измерено-предсказано&quot;
      для пошаговой калибровки. Здесь заметно,
      что описание сбалансировано уже гораздо
      лучше – отличие точности обучения от
      проверки не так существенно, как во
      множественной калибровке. В Табл. <span lang="en-us">5</span>
      приведены характеристики пошаговой
      калибровки веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, вычисленные в
      соответствие с формулами <a href="#Ch1.4">раздела
      1.4</a>.<span lang="en-us"> </span> <a name="Tabl05"></a>
		<span lang="en-us">&nbsp;</span> </p>
      <p align="center"><samp>Табл. <span lang="en-us">5</span> Характеристики
      качества пошаговой калибровки&nbsp;</samp></p>
      <p align="center"><a href="calibration/Calibration.xls#SWR!Z6">
		<img src="calibration/table05.png" class="style5"></a></p>
      <p align="left">Подводя итог можно заметить,
      что пошаговая регрессия дала наилучший
      результат среди всех исследованных
      нами методов калибровки. Но
      есть и более точные методы.</p>
      <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		<a name="ch5"></a></span></p>
        <h1 align="left"><span lang="en-us">5</span>. Калибровка на латентных 
		переменных <a name="Ch5.1"></a></h1>
      <h2 align="left"><span lang="en-us">5</span>.1. Проекционные методы</h2>
      <p align="left">В методе пошаговой калибровки
      использовались только два или три (наиболее
      информативных) канала из 101, и это
      позволило достичь приемлемого
      результата. Прочие каналы были
      отброшены как &quot;излишние&quot;, не нужные.
      Такой подход представляется несколько
      расточительным – ведь отброшенные
      данные содержали полезную информацию,
      которую хорошо было бы использовать. В
      частности, применяя SWR, мы не заметили
      присутствие третьего вещества – примеси
      <font face="Arial">
      C</font>, которая сильно проявляется как раз в
      этих исключенных каналах. Проблема,
      которую мы сейчас будет исследовать,
      состоит в следующем. Как использовать
      все имеющиеся данные (каналы), и, в то же
      время, избежать переоценки и
      мультколлинеарности, неизбежных при
      большом числе регрессионных переменных.&nbsp;</p>
      <p align="left">Решение этой дилеммы было
      предложено К. Пирсоном <span lang="en-us">(<a href="http://en.wikipedia.org/wiki/Karl_Pearson">Karl 
		Pearson</a>) </span>в 1901 году – надо
      использовать новые, латентные
      переменные <b>t</b><sub><i>a</i></sub>, (<i>a</i>=1,…<i>A</i>),
      являющиеся линейной комбинацией
      исходных переменных<b> x</b><sub><i>j</i></sub> (<i>j</i>=1,…<i>J</i>)
      –</p>
      <p align="center"><b>t</b><i><sub>a</sub></i>=<b>p</b><sub><i>a</i>1</sub><b>x</b><sub>1</sub>+…
      <b>p</b><i><sub>aJ</sub></i><b>x</b><i><sub>J</sub></i>&nbsp;</p>
      <p align="left">или в матричном виде</p>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq15"></a>&nbsp;<img border="0" src="calibration/image038.gif" class="style1"></b></td>
              <td>
                <p align="center">(15)</td>
            </tr>
          </table>
          </center>
        </div>
      <p align="left">В этом уравнении <b>T</b>
      называется матрицей счетов (scores). Ее
      размерность – (<i>I</i>&times;<i>A</i>). Матрица <b>P</b>
      называется матрицей нагрузок (loadings). Ее
      размерность (<i>A</i>&times;<i>J</i>). <b>E</b> – это
      матрицей остатков, размерностью (<i>I</i>&times;<i>J</i>).</p>
      <p align="left">Новые латентные переменные <b>t</b><i><sub>a</sub></i>
      называются главными компонентами (Principal
      Components), поэтому и сам метод называется<a href="pca.htm"> <i>
      методом главных компонент</i>  (PCA).</a> Число
      столбцов – <b>t</b><i><sub>a</sub></i> в матрице <strong>T</strong>, и <b>p</b><sub><i>a</i></sub>
      в матрице <b>P</b> – равно эффективному (химическому)
      рангу матрицы <b>X</b>. Эта величина
      обозначается <i>A</i> называется числом
      главных компонент (PC). Она заведомо
      меньше числа переменных <i>J</i> и числа
      образцов <i>I</i>.</p>
      <p align="left">Для иллюстрации метода PCA, мы
      опять вернемся к тому, как строились
      модельные данные (<a href="#Ch2.4">раздел 2.4</a>).
      Матрица спектров смесей <b>X</b> равна
      произведению матрицы концентраций <b>C</b>
      и матрицы спектров чистых компонентов <b>S</b>
      – формула (<a href="#Eq13">13</a>). Число строк в
      матрице <b>X</b> равно числу образцов (<i>I</i>),
      и каждая ее строка соответствует
      спектру одного образца, снятому для <i>J</i>
      длин волн. Число строк в матрице <b>C</b>
      также равно <i>I</i>, а вот число столбцов
      соответствует числу компонентов в смеси
      (<i>A</i>=3). У матрицы чистых спектров <b>S</b>
      число строк равно числу каналов (длин
      волн) <i>J</i>, а число столбцов равно <i>A</i>.
      При анализе экспериментальных данных <b>X</b>,
      отягощенных погрешностями,
      представленными в формуле (<a href="#Eq13">13</a>)
      матрицей <b>E</b>, эффективный ранг <i>A</i>
      может не совпадать с реальным числом
      компонентов в смеси.</p>
      <p align="left">Метод главных компонент часто
      применяется при исследовательском
      анализе химических данных. В общем
      случае матрицы счетов <b>T</b> и нагрузок <b>P</b>
      уже нельзя интерпретировать как спектры
      и концентрации, а <i> число главных
      компонент A</i> – как число химических
      компонентов, присутствующих в
      исследуемой системе. Тем не менее, даже
      формальный анализ счетов и нагрузок
      оказывается очень полезным для
      понимания устройства данных. Дадим
      простейшую двумерную иллюстрацию
      метода PCA.<a name="Fig27"></a></p>
        <p align="center"><img border="0" src="calibration/Fig27a.gif" width="338" height="333">&nbsp;
        <img border="0" src="calibration/Fig27b.gif" width="337" height="330"><p align="center"><samp>Рис.27
      Графическая иллюстрация метода главных
      компонент.&nbsp;<br>
      а) данные в исходных координатах, b)
      данные в координатах главных компонент</samp></p>
      <p align="left">На Рис. 27 показаны данные,
      состоящие только из двух переменных <i>x</i><sub>1</sub>
      и <i>x</i><sub>2</sub>, которые связаны сильной
      корреляцией. На соседнем рисунке те же
      данные представлены в новых координатах.
      Вектор нагрузок <b>p</b><sub>1</sub> первой
      главной компоненты (PC1) определяет
      направление новой оси, вдоль которой
      происходит наибольшее изменение данных.
      Проекции всех исходных точек на эту ось
      составляют вектор <b>t</b><sub>1</sub>. Вторая
      главная компонента <b>p</b><sub>2</sub>
      ортогональна первой, и ее направление
      (PC2) соответствует наибольшему изменению
      в остатках, показанных отрезками,
      перпендикулярными оси <b>p</b><sub>1</sub>. Этот
      тривиальный пример показывает, что
      метод главных компонент осуществляется
      последовательно, шаг за шагом. На каждом
      шаге исследуются остатки <b>E</b><i><sub>a</sub></i>,
      среди них выбирается направление
      наибольшего изменения, данные
      проецируются на эту ось, вычисляются
      новые остатки, и т. д. Этот алгоритм
      называется <a href="projection.htm#Ch1.2">NIPALS</a>.&nbsp;</p>
      <p align="left">Метод главных компонент можно
      трактовать как проецирование данных на
      подпространство меньшей размерности <i>A</i>.
      Возникающие при этом остатки <b>E</b>
      рассматриваются как шум, не содержащий
      значимой химической информации. На <a href="#Fig28"> Рис.
      28 </a> представлена графическая иллюстрация
      этого тезиса. <a name="Fig28"></a></p>
        <p align="center">&nbsp; <img border="0" src="calibration/Fig28a.gif" width="440" height="438">&nbsp;&nbsp;&nbsp;&nbsp;
        <img border="0" src="calibration/Fig28b.gif" width="240" height="342"><p align="center"><samp>Рис.28
      Метод главных компонент – как проекция
      на подпространство</samp></p>
      <p align="left">В случае, когда метод главных
      компонент применяется для решения
      калибровочной (регрессионной) задачи он
      носит название <em>регрессии на главные
      компоненты</em> (Principal Component Regression, PCR).&nbsp;</p>
      <p align="left"> В
      методе PCA проекция строится только по
      данным <b>X</b>. Значения откликов <b>Y</b>
      никак не используются. Обобщением
      метода PCA является <i> <a href="projection.htm#Ch1.3"> метод проекций на
      латентные структуры</a></i> (Projection on Latent Structures,
      PLS), который сейчас является самым
      популярным методом многомерной
      калибровки. Он во многом похож на метод
      PCR, с тем существенным отличием, что в PLS
      проводится одновременная декомпозиция
      матриц <b>X</b> и <b>Y</b>&nbsp;</p>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="40">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq16"></a>&nbsp;</b><b>X</b>=<b>TP</b><sup>t</sup>+<b>E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                Y</b>=<b>UQ</b><sup>t</sup>+<b>F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                T</b>=<b>XW</b>+<b>G</b></td>
              <td>
                <p align="center">(16)</td>
            </tr>
          </table>
          </center>
        </div>
      <p align="left">Проекция строится согласованно
      – так, чтобы максимизировать <a href="statistics.htm#Ch1.9">корреляцию</a>
      между соответствующими векторами X-счетов
      <b>t</b><i><sub>a</sub></i> и Y-счетов <b>u</b><i><sub>a</sub></i>.
      Поэтому PLS декомпозиция гораздо лучше
      описывает сложные связи, используя при
      этом меньшее число главных компонент.</p>
      <p align="center"><img border="0" src="calibration/Fig29.gif" width="646" height="393"></p>
      <p align="center"><samp>Рис. 29 Графическое
      представление метода проекций на
      латентные структуры&nbsp;</samp></p>
      <p align="left">В том случае, когда имеется
      несколько откликов <b>Y</b> (т.е. <i>K</i>&gt;1),
      можно построить две проекции исходных
      данных – PLS1 и PLS2. В первом случае для
      каждого из откликов <b>y</b><sub><i>k</i></sub>
      строится свое проекционное
      подпространство. При этом и счета <b>T</b> (<b>U</b>)
      и нагрузки <b>P</b> (<b>W</b>, <b>Q</b>) , зависят от
      того, какой отклик используется. Этот
      подход называется PLS1. Для метода PLS2
      строится одно общее проекционное
      пространство, которое является общим
      для всех откликов. </p>
<p align="left">Следует обратить
      внимание на то, что и PCA, и PLS методы не
      учитывают свободного члена при
      разложении матрицы <b>X</b>. Это видно из формул
      (<a href="#Eq15">15</a>) и (<a href="#Eq17">16</a>). Исходно
      предполагается, что все столбцы матриц <b>X</b>
      и <b>Y</b> имеют нулевое среднее, т.е.,</p>
      <p align="center"><img border="0" src="calibration/image039.gif" align="absmiddle" width="64" height="48">
      и 
		<img border="0" src="calibration/image040.gif" align="center" class="style1">
      для всех <i>j</i>=1,…, <i>J</i> и <i>k</i>=1,…, <i>K</i>&nbsp;</p>
      <p align="left">Этого легко можно достичь,
      проведя центрирование данных (<a href="#Ch1.8">раздел
      1.8 </a>и <a href="#Ch2.5">раздел 2.5</a>). Но, построив
      калибровочную модель на центрированных
      данных, надо не забыть пересчитать
      полученные оценки 
		<img border="0" src="calibration/image041.gif" align="center" class="style1">,
      добавив к ним вектор средних значений.&nbsp;</p>
      <p align="center"><img border="0" src="calibration/image042.gif" width="227" height="48"></p>
      <p align="left">Приведем некоторые полезные
      формулы, доказательство которых можно
      найти во многих <a href="references.htm"> учебниках </a> по анализу
      многомерных данных.</p>
      <p align="left">Во всех методах –&nbsp;</p>
      <p align="center"><img border="0" src="calibration/image043.gif" width="153" height="29"></p>
      <p align="left">В методе PCR –&nbsp;</p>
      <p align="center"><img border="0" src="calibration/image044.gif" width="151" height="29"></p>
      <p align="left">В методе PLS –</p>
      <p align="center"><img border="0" src="calibration/image045.gif" width="163" height="29"></p>
      <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		<a name="Ch5.2"></a></span></p>
      <h2 align="left"><span lang="en-us">5</span>.2. Регрессия на латентных 
		переменных&nbsp;</h2>
      <p align="left">После того, как данные <b>X</b>
      спроецированы на подпространство
      размерности <i>A</i>, исходная
      калибровочная задача (<a href="#Eq10">10</a>)
      превращается в серию регрессий на латентных переменных <span lang="en-us">
		<strong>T</strong> </span>–&nbsp;</p>
        <div align="center">
          <center>
          <table border="0" cellpadding="0" cellspacing="0" width="95%" height="40">
            <tr>
              <td width="90%">
                <p align="center"><b><a name="Eq17"></a>&nbsp;</b><b>T</b><i><sub>k</sub></i><b>b</b><i><sub>k</sub></i>=<i><b>y</b><sub>k</sub></i>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>k</i>=1,..,<i>K</i></td>
              <td>
                <p align="center">(17)</td>
            </tr>
          </table>
          </center>
        </div>
      <p align="left">Здесь индекс <i>k</i> нумерует
      отклики в матрице <b>Y</b>. Заметим, что в
      методах PCR и PLS2 имеется только одна
      матрица латентных переменных <b>T</b>=<b>T</b><sub>1</sub> = …= <b>T</b><i><sub>K</sub></i>. 
		Векторы <b>b</b><i><sub>k</sub></i> – это
      неизвестные коэффициенты, а <b>T</b><i><sub>k</sub></i>
      – матрицы счетов. Их общая размерность <i>A</i> существенно меньше числа переменных <i>J</i>,
      поэтому матрица <b>T</b><sub><i>k</i></sub><sup>t</sup><b>T</b><sub><i>k</i>
      </sub>обращается устойчиво и проблема
      мультиколлинеарности (<a href="#Ch1.7">раздел
      1.7</a>) не существенна. Но вот другая
      трудность – возможность переоценки (<a href="#Ch1.6">раздел
      1.6</a>) остается, и с ней нужно уметь
      справляться.</p>
      <p align="left">Для проекционных методов
      сложность модели целиком определяется
      числом главных компонент <i>A</i> и выбор
      этой величины является основной
      трудностью в проекционных методах.
      Существует много методов определения
      величины <i>A</i> – эффективной размерности
      многомерных данных. Выше мы уже отмечали,
      что часто она связана с химическим
      рангом системы, т.е. с числом веществ,
      присутствующих в системе. Однако самым
      универсальным способом оценки
      размерности <i>A</i> является исследование
      графиков величин <a href="#Ch1.4">RMSEC и RMSEP</a>, так как это
      было уже сделано в разделах <a href="#Ch1.6">1.6</a>
      и<span lang="en-us"> <a href="#Ch4.2">4.2</a></span>. <a name="Fig30"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PCR!B55">
		<img src="calibration/Fig30.png" class="style5"></a></p>
      <p align="center"><samp>Рис. 30 Графики T счетов в
      методе PCR&nbsp;</samp></p>
      <p align="left">При построении многомерных
      калибровок, большое внимание уделяется
      графикам счетов и нагрузок. Они несут в
      себе информацию, полезную для понимания
      того, как устроены данные. На графике
      счетов (Рис. 30) каждый образец
      изображается в координатах (<b>t</b><sub><i>i</i></sub>,
      <b>t</b><sub><i>j</i></sub>), чаще всего – (<b>t</b><sub>1</sub>,
      <b>t</b><sub>2</sub>). Близость двух точек
      означает их схожесть. Образцы,
      расположенные близко к началу координат
      (например, образцы 5, 11), являются самыми
      типичными – образцовыми. Напротив,
      образцы, которые находятся далеко (например,
      образцы 1 и 14), являются подозрительными
      маргиналами, и, может быть, даже
      <a href="statistics.htm#Ch3.2">выбросами</a>.<a name="Fig31"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PCR!AF10">
		<img src="calibration/Fig31.png" class="style5"></a></p>
      <p align="center"><samp>Рис. 31 Графики <b>P</b> нагрузок в
      методе PCR&nbsp;</samp></p>
      <p align="left">Если график счетов
      используется для анализа
      взаимоотношений образцов, то график
      нагрузок применяется для исследования
      роли переменных. На <a href="#Fig31"> Рис. 31 </a> показано как
      меняются нагрузки в зависимости от
      номера канала <i>j</i>. Можно обратить
      внимание на следующую закономерность.
      Чем больше номер главной компоненты, тем
      более зашумленным выглядит
      соответствующий нагрузки. График первой
      компоненты почти гладкий. По форме он
      похож на спектры чистых веществ <font face="Arial"> A</font> и
      <font face="Arial"> B</font> (см. <a href="#Fig11">Рис.
      11</a>). Вторая и третья главные компоненты
      отличаются более сложной формой, но они
      все еще имеют некоторые систематические
      тренды. А вот четвертая и пятые
      компоненты представляют просто
      случайный шум. Так, исследуя графики
      нагрузок, можно установить, что в нашем
      примере нужно использовать только 2 или 3
      главные компоненты, но ни никак не
      больше трех.</p>
      <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		<a name="Ch5.3"></a></span></p>
      <h2 align="left"><span lang="en-us">5</span>.3<span lang="en-us">.</span>&nbsp;Практическое применение
      калибровки&nbsp;на латентных переменных</h2>
      <p align="left">Калибровка на латентных переменных обычно
      строится на центрированном обучающем
      наборе (<b>X</b><sub>c</sub>, <b>Y</b><sub>c</sub>). Для того,
      чтобы получить прогноза на проверочный
      или новый набор образцов (<b>X</b><sub>t</sub>, <b>Y</b><sub>t</sub>),
      их надо также сцентрировать и
      спроецировать на уже имеющееся
      подпространство. Иными словами, нужно
      найти счета <b>T</b><sub>t</sub> новых образцов. В
      методе PCR это делается очень просто –&nbsp;</p>
      <p align="center"><b>T</b><sub>t</sub>=<b>X</b><sub>t </sub><b>P</b>,</p>
      <p align="left">где <b>P</b> – это матрица нагрузок,
      построенная по обучающему набору.&nbsp;</p>
      <p align="left">Для методов PLS дело обстоит
      гораздо сложнее. Вычислительные аспекты
      многомерной калибровки выходят за
      пределы настоящего пособия. Подробное
      изложение всех необходимых алгоритмов,
      а также соответствующие MatLab коды для PCA,
      PLS1 и PLS2 приведены в пособии <a href="matlab.htm">MatLab.
          Руководство для начинающих. </a></p>
<p align="left">Для
      работы с проекционными методами&nbsp;существуют большие коммерческие
      программы, например, <a href="http://www.camo.com/rt/Products/Unscrambler/unscrambler.html">The
      Unscrambler</a>, <a href="http://www.umetrics.com/default.asp/pagename/software_simcap/c/3">Simca-P</a>,
      которые представляют специальную среду
      для проведения различных манипуляций с
      многомерными данными. В частности, в них
      реализованы и все обсуждаемые методы
      калибровки. Среди свободно
      распространяемых программ можно
      отметить <a href="http://www.chm.bris.ac.uk/org/chemometrics/addins/index.html">Multivariate
      Analysis Add-in</a> – надстройка для Excel,
      разработанная в <a href="http://www.chm.bris.ac.uk/org/chemometrics/index.html">Хемометрическом
      центре</a> Бристольского университета
      под руководством проф. Р. Бреретона.&nbsp;</p>
      <p align="left">В этом пособии все проекционные
      вычисления (PCA/PLS) проводятся в рабочей книге <a href="calibration/Calibration.xls">
		<em>Calibration.xls</em></a> с помощью&nbsp;специальной
      надстройки (Add-In) к программе Excel, которое
      называется <em>Chemometrics.xla</em>. Оно дополняет
      список стандартных функций Excel и
      позволяет проводить&nbsp;разложение на
      листах рабочей книги. От том как ее установить написано в пособии
		<a href="installation.htm">Инсталляция Chemometrics Add-In</a>, а о том 
		как ее использовать, рассказано в 
      пособии <a href="projection.htm">Проекционные
      методы в системе Excel</a>.&nbsp;</p>
      <p align="left"><a href="#Contents">Содержание</a><a name="Ch5.4"></a></p>
      <h2 align="left"><span lang="en-us">5</span>.4. Регрессия на главные
      компоненты (PCR)</h2>
      <p align="left">Рассмотрим, как применяется PCR в
      модельном примере. Все вычисления
      приведены на листе <a href="calibration/Calibration.xls#PCR!A1">PCR</a>.&nbsp;<p align="left">Сначала, по
      обучающим данным <b>X</b><sub>c</sub>,
      находится матрица PCA счетов <b>T</b><sub>с</sub>
      размерностью (9&times;5). Она состоит из пяти
      столбцов – главных компонент <b>t</b><sub>a</sub>,
      <i>a</i>=1, 2, …, 5. С регрессионной точки
      зрения<b> T</b><sub>с</sub> – это матрица
      предикторов, т.е. независимых переменных.
      Двумя откликами будут <span class="style10">центрированные</span>
      значения концентраций  веществ <font face="Arial">A</font> и
      <font face="Arial">B</font>. Затем, с
      помощью функции <a href="excel.htm#TREND" class="prog"><strong>ТЕНДЕНЦИЯ</strong></a>
      <span lang="en-us">(<span class="prog"><strong>TREND</strong></span>) </span>для каждого отклика строятся по пять
      регрессий. В этих регрессиях участвуют,
      соответственно, одна, две, ... , пять
      главных PCA компонент. Так
      строится PCR калибровка на обучающем
      наборе.&nbsp;<p align="left">В этих простых вычислениях есть одна 
тонкость. Регрессия строится на центрированных данных A<sub>c</sub> и
<span lang="en-us">B</span><sub>c</sub> только потому, что в версии
<span lang="en-us">Excel 2003 </span>имеется <a href="excel.htm#Ch2.8">
критическая ошибка</a>, исправленная в последующих версия, начиная с
<span lang="en-us">Excel 2007. </span><p align="left">Проверочные данные тоже проецируются
      на пространство главных компонент и для
      них тоже определяются PCA счета <b>t</b><sub>1</sub>,
      …, <b>t</b><sub>5</sub>. К этим счетам применяется
      построенная калибровка, и находятся
      оценки центрированных концентраций A<sub>c</sub><sup>hat</sup>.
      Окончательные оценки откликов A<sup>hat </sup>для
      каждого числа главных компонент <i>a</i>
      получаются после учета центрирования по
      концентрациям&nbsp;
      <p align="left">
      Соответствующие значения
      среднеквадратичных остатков обучения (RMSEC)
      и проверки (RMSEP) показаны на Рис. 32. <a name="Fig32"></a>
      <p align="center"><a href="calibration/Calibration.xls#PCR!T55">
		<img src="calibration/Fig32.png" class="style5"></a><p align="center"><samp>Рис. 32 Среднеквадратичные
      остатки обучения (RMSEC) и проверки (RMSEP) в
      регрессии на главные компоненты&nbsp;</samp>
      <p align="left">Из Рис. 32 видно, что для обоих
      веществ минимум RMSEP достигается для трех
      PC (<i>A</i>=3). Таким образом, применив PCR, мы
      легко смогли установить, что в
      исследуемой системе присутствуют не два,
      а три вещества. <a name="Fig33"></a>
      <p align="center"><a href="calibration/Calibration.xls#PCR!B79">
		<img src="calibration/Fig33.png" class="style5"></a><p align="center"><samp>Рис. 33 Полная (TRV) и
      объясненная (ERV) дисперсии остатков в
      регрессии на главные компоненты&nbsp;</samp>
      <p align="left">На Рис. 33 показаны полная (TRV) и
      объясненная (ERV) дисперсии остатков. Эти
      графики также свидетельствуют о том, что
      эффективная размерность системы – три. Для трех PC
      объясненная дисперсия практически
      равна 1, а полная дисперсия близка к нулю.
      В тоже время, видно, что графики
      среднеквадратичных остатков (<a href="http://office.microsoft.com/assistance/hfws.aspx?AssetID=HP052093201033&amp;CTT=3&amp;Origin=HP052091551033&amp;Client=1#Fig32">Рис.
      32</a>) по сравнению с графиками дисперсий (<a href="#Fig33">Рис.
      33</a>) более наглядны. <a name="Fig34"></a>
      <p align="center"><a href="calibration/Calibration.xls#PCR!T80">
		<img src="calibration/Fig34.png" class="style5"></a><p align="center"><samp>Рис. 34 Графики &quot;измерено-предсказано&quot;
      в регрессии на главные компоненты.&nbsp;<br>
      Обучающий и проверочный наборы&nbsp;</samp>
      <p align="left">На Рис. 34 показаны графики &quot;измерено-предсказано&quot;
      для PCR при трех главных компонентах.
      Результат выглядит просто идеально – высокие коэффициенты корреляции, малые
      сдвиги, как в обучающем, так и
      проверочном наборах. Сравнивая эти
      графики с их аналогами в других метода –
      <a href="#Fig16">Рис. 16</a>, <a href="#Fig19">Рис. 19</a>, 
		<a href="#Fig21">Рис. 21</a>, <a href="#Fig23">Рис. 23</a><span lang="en-us">,
		</span><a href="#Fig26">Рис.<span lang="en-us"> 26</span></a> – можно увидеть очевидные
      преимущества регрессии на главные
      компоненты.
      <p align="left">В Табл. 6 приведены
      характеристики качества калибровки
      веществ <font face="Arial"> A</font> и <font face="Arial"> B</font>, построенной методом
      главных компонент. Все эти значения были
      вычислены в соответствие с формулами <a href="#Ch1.4">раздела
      1.4</a>.<span lang="en-us"> </span> <a name="Tab06"></a>
		<span lang="en-us">&nbsp;</span>
      <p align="center"><samp>Табл. 6 Характеристики
      качества регрессии на главные
      компоненты&nbsp;</samp>
      <p align="center"><a href="calibration/Calibration.xls#PCR!C41">
		<img src="calibration/table06.png" class="style5"></a>&nbsp;<p align="left">Таким образом, мы получили, что
      регрессия на главные компоненты (PCR)
      имеет явные преимущества в сравнении с методами классической
      калибровки. Этот способ моделирования
      точнее, имеет меньшее смещение. Это
      объясняется тем, что в многомерной
      калибровке используются все имеющиеся
      экспериментальные данные. При этом они
      модифицированы так, чтобы избежать как
      мультиколлинеарности, так и переоценки.
      <p align="left"><a href="#Contents">Содержание</a><a name="Ch5.5"></a></p>
      <h2 align="left"><span lang="en-us">5</span>.5<span lang="en-us">.</span> Регрессия на латентные
      структуры -1 (PLS1)&nbsp;</h2>
      <p align="left">Регрессия на латентные
      структуры (<a href="calibration/Calibration.xls#PLS1!A1">PLS1</a>) очень похожа на метод PCR.&nbsp;</p>
      <p align="left">Отличие состоит в том, что при
      построении проекционного пространства
      учитываются не только значения
      предикторов <b>X</b>, но и откликов <b>Y</b>. В
      результате получается не одна, а две
      матрицы <b>T</b> счетов – для каждого отклика (<font face="Arial">A</font> и
      <font face="Arial">B</font>) в отдельности. <a name="Fig35"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS1!B56">
		<img src="calibration/Fig35.png" class="style5"></a></p>
      <p align="center"><samp>Рис. 35 Графики <b>T</b> счетов в
      методе PLS1&nbsp;</samp></p>
      <p align="left">На <a href="#Fig35"> Рис. 35</a> показаны графики
      первых двух <b>T</b> счетов в регрессии PLS1 для
      откликов <font face="Arial"> A</font> и <font face="Arial">B</font>. При кажущемся различии, они
      очень схожи между собой и с аналогичным
      графиком PC1–PC2 на <a href="#Fig30">Рис. 30</a>. Чтобы
      это понять, достаточно изменить знаки у
      первой главной PLS компоненты для отклика
      <font face="Arial">A</font>. Такое преобразование главных
      компонент вполне законно. Дело в том, что,
      и PCA, и PLS декомпозиции определяются
      <a href="mcr.htm#Ch1.2">неоднозначно</a>. В эти разложения всегда
      можно вставить произвольную,
      дополнительную матрицу <b>O</b>, такую, что <b>OO</b><sup>t</sup>=<b>I</b>.
      Действительно –&nbsp;</p>
      <p align="center"><b>X </b>= <b>TP</b><sup>t</sup> = <b>TIP</b><sup>t</sup>&nbsp;
      = <b>T </b>(<b>OO</b><sup>t</sup>) <b>P</b><sup>t</sup> = (<b>TO</b>) (<b>PO</b>)<sup>t</sup>
      = (<b>T</b><sub>new</sub>) (<b>P</b><sub>new</sub>)<sup>t</sup>.&nbsp; <a name="Fig36"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS1!AM37">
		<img src="calibration/Fig36.png" class="style5"></a></p>
      <p align="center"><samp>Рис. 36. Графики весовых
      нагрузок <b>W</b> для отклика A в методе
      PLS1&nbsp;</samp></p>
      <p align="left">Аналогичная картина
      наблюдается и для нагрузок. На Рис. 36
      показаны весовые нагрузки <b>W</b> для
      отклика <font face="Arial">A</font>. Мы используем весовые
      нагрузки <b>W</b>, а не просто нагрузки <b>P</b>,
      потому, что они, по своей сути, ближе к <b>P</b>
      нагрузкам в методе PCA. </p>
<p align="left">Калибровка по
      методу PLS1 строится вполне аналогично
      методу PCR, только в этом случае для
      каждого отклика используется своя
      матрица счетов. <a name="Fig37"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS1!T56">
		<img src="calibration/Fig37.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 37 Среднеквадратичные
      остатки обучения (RMSEC) и проверки (RMSEP) в
      регрессии PLS1&nbsp;</samp></p>
      <p align="left">На <a href="#Fig37"> Рис. 37</a> показаны
      среднеквадратичные остатки обучения (RMSEC)
      и проверки (RMSEP) в регрессии PLS1. Этот
      график похож на свой аналог в методе PCR (<a href="#Fig32">Рис.
      32</a>). Здесь тоже очевидно, что минимум RMSEP
      достигается для трех PC (<i>A</i>=3). Некоторое
      отличие можно заметить только в
      поведении RMSEC – график не выходит на
      предел при трех PC, а продолжает падать с
      ростом числа компонент. В этом
      проявляется особенность метода
      проекций на латентные структуры – нацеленность на поддержание
      максимальной <a href="statistics.htm#Ch1.9">корреляции</a> между <b>T</b> и <b>U</b>
      счетами. <a name="Fig38"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS1!U80">
		<img src="calibration/Fig38.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 38 Графики &quot;измерено-предсказано&quot;
      в PLS1 регрессии. Обучающий и
      проверочный наборы&nbsp;</samp></p>
      <p align="left">Естественно, что и графики &quot;измерено-предсказано&quot;
      для калибровки методом PLS1 (<a href="#Fig38">Рис.
      38</a>) похожи
      на аналогичные графики для метода PCR (<a href="#Fig34">Рис.
      34</a>). То же можно сказать и о
      характеристиках качества калибровок,
      построенных методом PLS1, которые
      приведенные в Табл. <span lang="en-us">7</span>.<span lang="en-us">
		<a name="Tabl07"></a></span>&nbsp;</p>
      <p align="center"><samp>Табл. <span lang="en-us">7</span> Характеристики
      качества PLS1 регрессии&nbsp;</samp></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS1!C41">
		<img src="calibration/table07.png" class="style5"></a>&nbsp;</p>
      <p align="left">Таким образом, калибровка
      методом PLS1 для рассматриваемого
      модельного примера очень близка по
      своим свойствам к калибровке методом RCR.</p>
      <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		<a name="Ch5.6"></a></span></p>
      <h2 align="left"><span lang="en-us">5</span>.6<span lang="en-us">.</span> Регрессия на латентные
      структуры -2 (PLS2)&nbsp;</h2>
      <p align="left">Если метод PLS1 был похож на метод
      PCR, то отличие между PLS1 и <a href="calibration/Calibration.xls#PLS2!A1"> PLS2</a> в нашем
      примере еще менее заметно.&nbsp;</p>
      <p align="left"> При
      построении проекционного пространства
      PLS2 также учитываются значения и <b>X</b>, и <b>Y</b>.
      Однако все отклики <b>Y</b> рассматриваются
      совместно, поэтому получаются не
      несколько (как в PLS1), а одно общее
      проекционное подпространство (как в PCR)&nbsp;
      В результате мы имеем пару матриц
      счетов <b>T</b> и <b>U</b><b>,</b> и три матрицы
      нагрузок <b>P</b>, <b>W</b>  и <b>Q</b>. <a name="Fig39"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS2!B55">
		<img src="calibration/Fig39.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 39 Графики <b>T</b> счетов в
      методе PLS2&nbsp;</samp></p>
      <p align="left">На Рис. 39 показаны графики
      первых трех <b>T</b> счетов в регрессии PLS2.
      Сравнивая их с аналогичными графиками
      на <a href="#Fig30">Рис. 30</a> и <a href="#Fig35">Рис. 35</a>,
      легко заметить сходство. То же самое
      видно и для <b>W</b> нагрузок,
      представленных на <a href="#Fig40"> Рис. 40</a>. <a name="Fig40"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS2!AG29">
		<img src="calibration/Fig40.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 40. Графики весовых
      нагрузок <b> W</b> в методе PLS2&nbsp;</samp></p>
      <p align="left">Сравнивая <b>P</b> нагрузки в
      методе PCR на <a href="#Fig31">Рис. 31</a> и <b>W</b>
      нагрузки в методе PLS2, можно заметить, что
      между первыми тремя компонентами (нагрузками)
      есть хорошая линейная корреляция – для PC1
      положительная (<i>R</i> = 0.9999), а для PC2 и PC3
      отрицательная (<i>R</i> = –0.990, <i>R</i> = –0.987). Но
      вот четвертые компоненты уже никак не
      связаны друг с другом (<i>R</i> = 0.221). Смотри <a href="#Fig41">Рис.
      41</a>a). Это еще одно, дополнительное
      подтверждение того, что эффективная
      размерность исследуемой системы – три. <a name="Fig41"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS2!U55">
		<img src="calibration/Fig41.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 41 a) Корреляция между <b> P</b>
      нагрузками в методе PCR и <b> W</b> нагрузками в
      методе PLS2&nbsp;<br>
      b) Корреляция между <b> W</b> нагрузками вещества
      B в методе PLS1 и <b> W</b> нагрузками в методе
      PLS2&nbsp;</samp></p>
      <p align="left">Однако между методами PLS1 и PLS2
      такой интересной связи не наблюдается.
      На <a href="#Fig41">Рис. 41b)</a> показано, как
      связаны между собой <b>W</b> нагрузки,
      найденные методами PLS1 и PLS2. В первом
      случае использовались PLS1 <b>W</b> нагрузки
      для вещества <font face="Arial"> B</font>, но и для вещества
      <font face="Arial"> A</font>
      наблюдается аналогичная картина.&nbsp;</p>
      <p align="left">После того, как построена
      проекция на PLS2 подпространство,
      калибровка строится также как в методе
      PCR. <a name="Fig42"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS2!B79">
		<img src="calibration/Fig42.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 42 Среднеквадратичные
      остатки обучения (RMSEC) и проверки (RMSEP) в
      методе PLS2&nbsp;</samp></p>
      <p align="left">По <a href="#Fig42"> Рис. 42,</a> на котором показаны
      среднеквадратичные остатки обучения (RMSEC)
      и проверки (RMSEP) в регрессии PLS2, легко
      определить нужное число главных
      компонент <i>A</i>=3. Отличия от
      аналогичного графика на <a href="#Fig37">Рис. 37</a>
      в методе PLS1 глазом не различимы.<a name="Fig43"></a></p>
      <p align="center"><a href="calibration/Calibration.xls#PLS2!B103">
		<img src="calibration/Fig43.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>&nbsp;Рис. 43 Графики &quot;измерено-предсказано&quot;
      в PLS2 регрессии. Обучающий и
      проверочный наборы&nbsp;</samp></p>
      <p align="left">Также неотличимы и графики &quot;измерено-предсказано&quot;
      для PLS1 (<a href="#Fig38">Рис. 38</a>) и PLS2 (<a href="#Fig43">Рис.
      43</a>). Характеристики качества PLS2
      калибровки, которые приведены в <a href="#Tabl08">Табл. 8</a><span lang="en-us">
		</span>совпадают с аналогичными для PLS1 (<a href="#Tabl07">Табл. 7</a>).<span lang="en-us">
		</span>&nbsp;<span lang="en-us"><a name="Tabl08"></a> </span></p>
      <p align="center"><samp>Табл. 8 Характеристики
      качества PLS2 регрессии&nbsp;</samp></p>
<p align="center"><a href="calibration/Calibration.xls#PLS2!C41">
<img src="calibration/table08.png" class="style5"></a>&nbsp;</p>
      <p align="left">Может сложиться впечатление,
      что PLS2 регрессия не дает ничего нового
      по сравнению с PLS1 регрессией.
      Действительно, в большинстве случаев
      так и происходит. Более того, если между
      откликами в матрице <b>Y</b> нет корреляции,
      то PLS1 обычно дает лучшие результаты,
      нежели PLS2. Для прояснения этой ситуации
      бывает полезно построить PCA
      декомпозицию для матрицы <b>Y</b>. Если это
      разложение обнаруживает связи между
      откликами, то метод PLS2 может оказаться
      очень полезным. Дальнейшее обсуждение
      этой интересной проблемы выходит за
      рамки настоящего пособия.</p>
      <p align="left"><a href="#Contents">Содержание</a><a name="Ch6"></a><span lang="en-us">
		</span></p>
        <h1 align="left">6. Заключение <a name="Ch6.1"></a></h1>
        <h2 align="left"><span lang="en-us">6</span>.1. Сравнение разных методов&nbsp;</h2>
        <p align="left">Сопоставление различных
        методов начнем с характеристик <a href="#Eq4"> RMSEC</a> и
        <a href="#Eq4"> RMSEP</a>,
        которые наиболее полно отражают
        качество моделирования.&nbsp;<a name="Fig44"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#Compare!K3">
		<img src="calibration/Fig44.png" class="style5"></a>&nbsp;</p>
        <p align="center"><samp>Рис. 44 Среднеквадратичные
        остатки обучения (RMSEC) и проверки (RMSEP)&nbsp;<br>
 в
        различных методах калибровки веществ A
        и B&nbsp;</samp></p>
        <p align="left">На <a href="#Fig44"> Рис. 44</a> показаны
        среднеквадратичные остатки обучения и
        проверки, вычисленные для различных
        методов калибровки. Первое, что можно
        заметить на этих графиках – явное
        превосходство калибровки<span lang="en-us"> </span>на латентных 
		переменных:
        PCR, PLS и PLS2, перед традиционными
        подходами. Вторая интересная
        особенность состоит в том, что, часто, RMSEP больше, чем RMSEC. Это типично
        для правильной калибровки, если только
        различие между RMSEP и RMSEC не так
        разительно, как в случае множественной
        калибровки (<a href="#Ch4.1">MLR</a>) или пошаговой регрессии
        (<a href="#Ch4.2">SWR</a>) вещества <span lang="en-us">B</span>.&nbsp;<a name="Fig45"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#Compare!K26">
		<img src="calibration/Fig45.png" class="style5"></a>&nbsp;</p>
        <p align="center"><samp>Рис. 45 Смещение в обучении (BIASC)
        и в проверке (BIASP) для различных методов
        калибровки веществ A и B&nbsp;</samp></p>
      <p align="left">На <a href="#Fig45"> Рис. 45</a> представлены
        величины смещений, полученные на
        обучающей выборке (<a href="#Eq5">BIASC</a>) и на проверочной
        (<a href="#Eq5">BIASP</a>) выборке. Здесь опять мы видим
        превосходство<span lang="en-us"> </span>проекционных методов,
        которые дают значительно меньшие
        величины систематических отклонений.
        Аналогично, почти всегда BIASC меньше, чем
        BIASP, а для <a href="#Ch3.1">UVR</a> и <a href="#Ch4.1">MLR</a>
      отличие обучения от
        проверки особенно заметно.&nbsp;<a name="Fig46"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#Compare!K50">
		<img src="calibration/Fig46.png" class="style5"></a>&nbsp;</p>
      <p align="center"><samp>Рис. 46 Коэффициенты
        корреляции в обучении и в проверке для
        различных методов калибровки веществ A
        и B</samp></p>
        <p align="left">На Рис. 46 показаны величины <a href="#Eq7">
        коэффициентов корреляции</a> между
        стандартными и оцененными откликами.
        Видно, что проекционные методы не только
        дают лучшие значения <i>R</i><sup>2</sup> (ближе к единице),
        но и , кроме того, представляют
        правильный баланс между обучением и
        проверкой.&nbsp;<a name="Fig47"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#Compare!K74">
		<img src="calibration/Fig47.png" class="style5"></a>&nbsp;</p>
        <p align="center"><samp>Рис. 47 Стандартные ошибки в
        обучении (SEC) и в проверке (SEP) для
        различных методов калибровки веществ A
        и B&nbsp;</samp></p>
        <p align="left">На Рис. 47 показаны стандартные
        ошибки в обучении (<a href="#Eq6">SEC</a>) и в проверке (<a href="#Eq6">SEP</a>).
        Из-за того, что в нашем примере все
        смещения малы по сравнению с RMSE, эти
        графики не добавляют нам новых
        открытий по сравнению с уже
        исследованными зависимостями показанными на <a href="#Fig44"> Рис.
        44.</a>&nbsp;<a name="Fig48"></a></p>
        <p align="center"><a href="calibration/Calibration.xls#Compare!K98">
		<img src="calibration/Fig48.png" class="style5"></a>&nbsp;</p>
        <p align="center"><samp>Рис. 48 Полная дисперсия
        остатков в обучении (TRVC) и в проверке (TRVP)&nbsp;<br>
        Объясненная дисперсия остатков в
        обучении (ERVC) и в проверке (ERVP)&nbsp;<br>
 для
        различных методов калибровки веществ A
        и B&nbsp;</samp></p>
      <p align="left">На Рис. 48 слева приведена <a href="#Eq2"> полная
      дисперсия</a> остатков в обучении (TRVC) и в
      проверке (TRVP), а справа – <a href="#Eq3"> объясненная
      дисперсия</a> остатков в обучении (ERVC) и в
      проверке (ERVP). На этих графиках мы снова
      видим те же закономерности, что и ранее –
      методы калибровки на латентных переменных лучше
      традиционных. Можно также отметить, что
      графики ERV неудобны для анализа
      качества моделирования – на них плохо
      заметны недостатки или преимущества
      различных методов</p>
      <p align="left"><a href="#Contents">Содержание</a><span lang="en-us">
		<a name="Ch6.2"></a></span></p>
      <h2 align="left"><span lang="en-us">6</span>.2. Выводы&nbsp;</h2>
      <p align="left">Подведем итоги исследования
      различных методов калибровки. Итак, мы
      видели, что –&nbsp;&nbsp;</p>
      <ul>
        <li>
          <p align="left" style="line-height: 150%">калибровка по одному каналу
          приводит к недооценке – величины RMSEC и
          RMSEP слишком велики;&nbsp;</li>
        <li>
          <p align="left" style="line-height: 150%">множественная калибровка,
          напротив, ведет к переоценке – величина RMSEC значительно меньше, чем
          RMSEP;&nbsp;</li>
        <li>
          <p align="left" style="line-height: 150%">наилучшие результаты дает
          калибровка на латентных переменных (PCR и PLS) – достигается правильный баланс между
          величинами RMSEC и RMSEP</li>
      </ul>
      <p align="left"><a href="#Contents">Содержание</a></p>
      <p align="left">&nbsp;</p>
  </table>

</body>

